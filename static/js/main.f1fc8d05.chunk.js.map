{"version":3,"sources":["Translation.js","RareItemnames.js","ModGroups.js","App.js","serviceWorker.js","index.js"],"names":["TranslationHelper","IndexHandlers","v","toFixed","Math","floor","stringformat","fmt","args","Array","prototype","slice","call","arguments","replace","match","number","GetTranslationLinesForMod","translationJson","mod","values","consumedIdxs","Set","translationLines","statIdx","has","statObj","statId","translationIdx","add","translation","translationStatIdx","findIndex","x","translationLine","numStatsInTranslation","length","fill","addlStatIdx","addlStat","addlStatId","addlStatTranslationIdx","push","GetTranslationRuleForLine","line","translationRule","conditionsFailed","condition","value","ApplyIndexHandlers","indexHandlers","handler","this","GetStringForTranslationRule","rule","stringReplacementForValues","replacementStrings","replacementMin","replacementMax","replacementValue","replacementCombined","GetStringsForTranslationLines","strings","lineIdx","concat","split","TranslateMod","TranslateModForGroup","RarePrefixes","RareSuffixes","GenerateRareName","itemData","rng","prefixIdx","suffixPool","includes","ModLookupTables","domainTable","groupedModTable","statLineIndices","tags","modId","domain","group","type","addToDomainTable","addToGroupedModTable","addStatLineIndices","addTags","statIndices","key","getGroupedTableKey","join","modData","getStatLineIndices","ParseModGroups","mods","stats","mod_types","modLookupTables","statKeyToIndex","idx","statKey","stat","id","modTags","randRange","minInclusive","maxInclusive","quick","PropertyLine","props","replacementIdx","replacementSpans","map","className","lineSplit","output","i","TipLine","ModLine","ItemNameLine","topLine","bottomLine","ItemHeader","double","generatedName","itemTypeName","leftSymbolClass","influences","rightSymbolClass","CraftedItem","base_items","itemState","baseItemId","modInstance","generationType","context","toUpperCase","tierCount","tier","tierCountAtItemLevel","stat_translations","getStatLines","getTipLine","showMods","implicits","sortMods","SortMods","getImplicitLine","affixes","getAffixLine","groups","separatedGroups","separatoridx","rarity","getItemTypeName","level","getGroupsWithSeparators","getImplicitBoxes","getAffixBoxes","React","Component","ModListLine","spanIdx","nameLineElements","nameLines","splice","lineClass","tierString","weight","prob","ModList","modAndWeightGroup","totalWeight","modWeight","modName","modTierInfo","GetTierForMod","toLocaleString","undefined","style","minimumFractionDigits","collapsed","groupWeight","reduce","total","groupName","elementList","renderModsInModGroup","modsAndWeights","fossilTypes","weightParameters","GetWeightParametersForFossils","GetValidModsAndWeightsForItem","ignoreAffixLimits","ignoreExistingGroups","sort","a","b","ModIdComparer","rarityOverride","modGroups","currentGroupIdx","currentGroupTableKey","modIdx","groupedTableKey","getGroupedTableKeyForMod","renderModGroup","CanBaseItemHaveRarity","GetSpawnWeightForMod","spawnWeight","GetPrefixCount","existingAffixCount","GetSuffixCount","GetAffixCount","GetPrefixLimitForRarity","baseItem","GetSuffixLimitForRarity","GetAffixLimitForRarity","GetAffixLimit","CanModBeAddedToItem","hasPrefixSlots","hasSuffixSlots","existingModGroups","modGroup","extendedParameters","validMods","GetBaseItemTags","affix","GetAddedTags","GetItemTags","requiredPositiveWeightTag","negativeWeightMultipliers","positiveWeightMultipliers","addedMods","existingMod","modIds","getDomainTable","find","getTags","modTag","totalPositiveWeightMultiplier","GetInfluenceTag","influence","baseItemClass","item_classes","influenceTagId","influenceTag","implicit","RollModValues","statRolls","modTier","modCount","modCountAtItemLevel","modLevel","baseItemTags","otherModIds","getGroupedTable","otherModId","otherMod","CreateRolledMod","tierValues","RollRareName","RareItemNames","RollRareAffixCount","maxAffixCount","randInt","cloneMods","modArray","newArray","oldModIdx","cloneItemState","corruptions","CreateItem","corrupted","quality","implicitId","AddRandomModFromListAndWeights","newItemState","modPool","randRoll","weightAccum","modEndWeight","PickModFromWeightedModPool","modAndWeight","CreateWeightedModPool","AddRandomMod","generationTypeOrder","modA","modB","modAGenerationType","modBGenerationType","aStatIndices","bStatIndices","aNumStats","bNumStats","modARequiredLevel","modBRequiredLevel","modList","sortedList","ModComparer","CanAddInfluenceToItem","AddInfluenceToItem","newState","CanScourItem","ScourItem","CanTransmutationItem","TransmutationItem","numMods","CanAlterationItem","AlterationItem","CanAugmentationItem","AugmentationItem","result","CanRegalItem","RegalItem","CanAlchemyItem","AlchemyItem","CanChaosItem","ChaosItem","CanExaltedItem","ExaltedItem","CanExaltedWithInfluenceItem","ExaltedWithInfluenceItem","CanAnnulmentItem","AnnulmentItem","numAffixes","affixIdxToRemove","CanBlessedItem","BlessedItem","CanDivineItem","DivineItem","CanFossilItem","fossilId","fossil","fossils","hasAllowedTag","allowedTag","forbiddenTag","forcedMods","negativeTagMultipliers","positiveTagMultipliers","rollsLucky","negativeWeightMod","tag","weightMultiplier","positiveWeightMod","FossilItem","CraftingButton","onClick","disabled","enabled","label","TheoryCrafterContext","modDatabase","ModGroups","TheoryCrafter","testMap","actionMap","theoryCrafterContext","_mods","seedrandom","normalItemState","state","initState","initItemState","itemStateHistory","action","itemStateHistoryIdx","lastCommand","selectedBaseId","selectedBaseLevel","selectedFossils","actionName","canUndoState","setState","canRerollAction","previousItemState","canPerformAction","performAction","canRedoState","index","newStateHistory","insertAndCutStateAt","splitAndTestAction","splitAction","splitLocationOverride","splitAndExecuteAction","insertAndCutState","e","target","baseItems","lastIndexOf","onChange","handleSelectedBaseChanged","Object","keys","k","handleSelectedBaseLevelChanged","handleBaseSelectButtonClicked","getState","checked","handleFossilSelectorClicked","RenderBaseSelectList","RenderBaseSelectLevel","RenderBaseSelectButton","RenderCraftingButton","RenderFossilSelector","undoState","getUndoLabel","redoState","getRedoLabel","rerollAction","getRerollLabel","handleSortModsToggled","color","App","Boolean","window","location","hostname","ReactDOM","render","document","getElementById","navigator","serviceWorker","ready","then","registration","unregister"],"mappings":"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","file":"static/js/main.f1fc8d05.chunk.js","sourcesContent":["export default class TranslationHelper {\r\n    static IndexHandlers = {\r\n        \"30%_of_value\": v => { return v * 0.3 },\r\n        \"60%_of_value\": v => { return v * 0.6 },\r\n        \"deciseconds_to_seconds\": v => { return v / 10 },\r\n        \"divide_by_one_hundred\": v => { return v / 100 },\r\n        \"divide_by_one_hundred_and_negate\": v => { return -v / 100 },\r\n        \"divide_by_one_hundred_2dp\": v => { return (v / 100).toFixed(2) },\r\n        \"milliseconds_to_seconds\": v => { return v / 1000 },\r\n        \"milliseconds_to_seconds_0dp\": v => { return (v / 1000).toFixed(0) },\r\n        \"milliseconds_to_seconds_1dp\": v => { return (v / 1000).toFixed(1) },\r\n        \"milliseconds_to_seconds_2dp\": v => { return (v / 1000).toFixed(2) },\r\n        \"milliseconds_to_seconds_2dp_if_required\": v => { return (v / 1000).toFixed(2) },\r\n        \"multiplicative_damage_modifier\": v => { return v + 100 },\r\n        \"multiplicative_permyriad_damage_modifier\": v => { return v / 100 + 100 },\r\n        \"negate\": v => { return -v },\r\n        \"old_leech_percent\": v => { return v / 5 },\r\n        \"old_leech_permyriad\": v => { return v / 500 },\r\n        \"per_minute_to_per_second\": v => { return (v / 60).toFixed(1) },\r\n        \"per_minute_to_per_second_0dp\": v => { return (v / 60).toFixed(0) },\r\n        \"per_minute_to_per_second_1dp\": v => { return (v / 60).toFixed(1) },\r\n        \"per_minute_to_per_second_2dp\": v => { return (v / 60).toFixed(2) },\r\n        \"per_minute_to_per_second_2dp_if_required\": v => { return (v / 60).toFixed(2) },\r\n        \"divide_by_two_0dp\": v => { return Math.floor(v / 2) },\r\n        \"divide_by_six\": v => { return v / 6 },\r\n        \"divide_by_ten_0dp\": v => { return Math.floor(v / 10) },\r\n        \"divide_by_twelve\": v => { return v / 12 },\r\n        \"divide_by_fifteen_0dp\": v => { return Math.floor(v / 15) },\r\n        \"divide_by_twenty_then_double_0dp\": v => { return Math.floor(v / 20) * 2 },\r\n        \"times_twenty\": v => { return v * 20 }\r\n    };\r\n\r\n    static stringformat = function(fmt) {\r\n        const args = Array.prototype.slice.call(arguments, 1);\r\n        return fmt.replace(/{(\\d+)}/g, (match, number) => {\r\n            return args[0][number];\r\n        });\r\n    }\r\n\r\n    static GetTranslationLinesForMod = function(translationJson, mod, values = null) {\r\n        let consumedIdxs = new Set();\r\n        let translationLines = [];\r\n        for (let statIdx in mod[\"stats\"]) {\r\n            if (consumedIdxs.has(statIdx)) {\r\n                continue;\r\n            }\r\n            const statObj = mod[\"stats\"][statIdx];\r\n            const statId = statObj[\"id\"];\r\n            consumedIdxs.add(statIdx);\r\n\r\n            for (const translationIdx in translationJson) {\r\n                const translation = translationJson[translationIdx];\r\n                const translationStatIdx = translation[\"ids\"].findIndex((x => x === statId));\r\n                if (translationStatIdx >= 0) {\r\n                    let translationLine = {};\r\n                    translationLine[\"tidx\"] = translationIdx;\r\n                    const numStatsInTranslation = translation[\"ids\"].length;\r\n                    translationLine[\"mins\"] = Array(numStatsInTranslation).fill(0);\r\n                    translationLine[\"maxs\"] = Array(numStatsInTranslation).fill(0);\r\n                    if (values)\r\n                        translationLine[\"values\"] = Array(numStatsInTranslation).fill(0);\r\n\r\n                    translationLine[\"mins\"][translationStatIdx] = statObj[\"min\"];\r\n                    translationLine[\"maxs\"][translationStatIdx] = statObj[\"max\"];\r\n                    if (values)                    \r\n                        translationLine[\"values\"][translationStatIdx] = values[statIdx];\r\n\r\n                    for (let addlStatIdx in mod[\"stats\"]) {\r\n                        const addlStat = mod[\"stats\"][addlStatIdx];\r\n                        const addlStatId = addlStat[\"id\"];\r\n                        if (consumedIdxs.has(addlStatIdx)) {\r\n                            continue;\r\n                        }\r\n                        const addlStatTranslationIdx = translation[\"ids\"].findIndex((x => x === addlStatId));\r\n                        if (addlStatTranslationIdx > 0) {\r\n                            translationLine[\"mins\"][addlStatTranslationIdx] = addlStat[\"min\"];\r\n                            translationLine[\"maxs\"][addlStatTranslationIdx] = addlStat[\"max\"];\r\n                            if (values)                            \r\n                                translationLine[\"values\"][addlStatTranslationIdx] = values[addlStatIdx];\r\n\r\n                            consumedIdxs.add(addlStatIdx);\r\n                        }\r\n                    }\r\n                    translationLines.push(translationLine);\r\n                }\r\n            }\r\n        }\r\n        return translationLines;\r\n    }\r\n\r\n    static GetTranslationRuleForLine = function(translationJson, line) {\r\n        const translation = translationJson[line[\"tidx\"]][\"English\"];\r\n        for (const translationRule of translation) {\r\n            let conditionsFailed = false;\r\n            for (const statIdx in line[\"mins\"]) {\r\n                let condition = translationRule[\"condition\"][statIdx];\r\n                const value = line[\"mins\"][statIdx];\r\n                if (\"min\" in condition) {\r\n                    if (value < condition[\"min\"]) {\r\n                        conditionsFailed = true;\r\n                        break;\r\n                    }\r\n                }\r\n                if (\"max\" in condition) {\r\n                    if (value > condition[\"max\"]) {\r\n                        conditionsFailed = true;\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n            if (!conditionsFailed) {\r\n                return translationRule;\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n\r\n    static ApplyIndexHandlers = function(indexHandlers, value) {\r\n        for (const handler of indexHandlers) {\r\n            value = this.IndexHandlers[handler](value)\r\n        }\r\n        return value;\r\n    }\r\n\r\n    static GetStringForTranslationRule = function(translationJson, rule, line, stringReplacementForValues = null) {\r\n        const translation = translationJson[line[\"tidx\"]];\r\n        let replacementStrings = Array(translation[\"ids\"].length);\r\n        for (const statIdx in translation[\"ids\"]) {\r\n            let replacementMin = this.ApplyIndexHandlers(rule[\"index_handlers\"][statIdx], line[\"mins\"][statIdx]);\r\n            let replacementMax = this.ApplyIndexHandlers(rule[\"index_handlers\"][statIdx], line[\"maxs\"][statIdx]);\r\n            let replacementValue = null;\r\n            if (\"values\" in line) {\r\n                replacementValue = this.ApplyIndexHandlers(rule[\"index_handlers\"][statIdx], line[\"values\"][statIdx]);\r\n            }\r\n\r\n            let replacementCombined = \"\";\r\n            if (replacementMin === replacementMax) {\r\n                if (stringReplacementForValues) {\r\n                    replacementCombined = stringReplacementForValues;\r\n                }\r\n                else {\r\n                    replacementCombined = replacementMin;\r\n                }\r\n            }\r\n            else {\r\n                if (stringReplacementForValues) {\r\n                    replacementMin = stringReplacementForValues;\r\n                    replacementMax = stringReplacementForValues;\r\n                    if (replacementValue) {\r\n                        replacementValue = stringReplacementForValues;\r\n                    }\r\n                }\r\n\r\n                replacementCombined = \"(\" + replacementMin + \"-\" + replacementMax + \")\";\r\n                if (replacementValue) {\r\n                    replacementCombined = replacementValue + replacementCombined;\r\n                }\r\n            }\r\n            replacementStrings[statIdx] = rule[\"format\"][statIdx].replace(\"#\", replacementCombined);\r\n        }\r\n        return this.stringformat(rule[\"string\"], replacementStrings);\r\n    }\r\n\r\n    static GetStringsForTranslationLines = function(translationJson, translationLines, stringReplacementForValues = null) {\r\n        let strings = [];\r\n        for (const lineIdx in translationLines) {\r\n            const translationRule = this.GetTranslationRuleForLine(translationJson, translationLines[lineIdx]);\r\n            if (translationRule) {\r\n                strings = strings.concat(this.GetStringForTranslationRule(translationJson, translationRule, translationLines[lineIdx], stringReplacementForValues).split(\"\\n\"));\r\n            }\r\n        }\r\n        return strings;\r\n    }\r\n\r\n    static TranslateMod = function(translationJson, mod, values = null) {\r\n        const translationLines = this.GetTranslationLinesForMod(translationJson, mod, values);\r\n        return this.GetStringsForTranslationLines(translationJson, translationLines);\r\n    }\r\n\r\n    static TranslateModForGroup = function(translationJson, mod) {\r\n        const translationLines = this.GetTranslationLinesForMod(translationJson, mod, null);\r\n        return this.GetStringsForTranslationLines(translationJson, translationLines, \"x\");\r\n    }    \r\n}","const RarePrefixes = [\r\n    \"Agony\", \"Apocalypse\", \"Armageddon\", \"Beast\", \"Behemoth\", \"Blight\", \"Blood\", \"Bramble\", \"Brimstone\", \"Brood\", \"Carrion\", \"Cataclysm\", \"Chimeric\", \"Corpse\", \"Corruption\", \"Damnation\", \"Death\", \"Demon\", \"Dire\", \"Dragon\", \"Dread\", \"Doom\", \"Dusk\", \"Eagle\", \"Empyrean\", \"Fate\", \"Foe\", \"Gale\", \"Ghoul\", \"Gloom\", \"Glyph\", \"Golem\", \"Grim\", \"Hate\", \"Havoc\", \"Honour\", \"Horror\", \"Hypnotic\", \"Kraken\", \"Loath\", \"Maelstrom\", \"Mind\", \"Miracle\", \"Morbid\", \"Oblivion\", \"Onslaught\", \"Pain\", \"Pandemonium\", \"Phoenix\", \"Plague\", \"Rage\", \"Rapture\", \"Rune\", \"Skull\", \"Sol\", \"Soul\", \"Sorrow\", \"Spirit\", \"Storm\", \"Tempest\", \"Torment\", \"Vengeance\", \"Victory\", \"Viper\", \"Vortex\", \"Woe\", \"Wrath\"\r\n];\r\n\r\nconst RareSuffixes = {\r\n    \"One Hand Axe\" : [\"Bane\", \"Bite\", \"Edge\", \"Hunger\", \"Roar\", \"Song\", \"Thirst\", \"Beak\", \"Butcher\", \"Etcher\", \"Gnash\", \"Mangler\", \"Rend\", \"Sever\", \"Slayer\", \"Spawn\", \"Splitter\", \"Sunder\" ],\r\n    \"Two Hand Axe\" : [\"Bane\", \"Bite\", \"Edge\", \"Hunger\", \"Roar\", \"Song\", \"Thirst\", \"Beak\", \"Butcher\", \"Etcher\", \"Gnash\", \"Mangler\", \"Rend\", \"Sever\", \"Slayer\", \"Spawn\", \"Splitter\", \"Sunder\" ],\r\n    \"One Hand Mace\" : [\"Bane\", \"Batter\", \"Blast\", \"Blow\", \"Blunt\", \"Brand\", \"Breaker\", \"Burst\", \"Crack\", \"Crusher\", \"Grinder\", \"Knell\", \"Mangler\", \"Ram\", \"Roar\", \"Ruin\", \"Shatter\", \"Smasher\", \"Star\", \"Thresher\", \"Wreck\" ],\r\n    \"Two Hand Mace\" : [\"Bane\", \"Batter\", \"Blast\", \"Blow\", \"Blunt\", \"Brand\", \"Breaker\", \"Burst\", \"Crack\", \"Crusher\", \"Grinder\", \"Knell\", \"Mangler\", \"Ram\", \"Roar\", \"Ruin\", \"Shatter\", \"Smasher\", \"Star\", \"Thresher\", \"Wreck\" ],\r\n    \"Sceptre\" : [\"Bane\", \"Blow\", \"Breaker\", \"Call\", \"Chant\", \"Crack\", \"Crusher\", \"Cry\", \"Gnarl\", \"Grinder\", \"Knell\", \"Ram\", \"Roar\", \"Smasher\", \"Song\", \"Spell\", \"Star\", \"Weaver\" ],\r\n    \"Staff\" : [\"Bane\", \"Beam\", \"Branch\", \"Call\", \"Chant\", \"Cry\", \"Gnarl\", \"Goad\", \"Mast\", \"Pile\", \"Pillar\", \"Pole\", \"Post\", \"Roar\", \"Song\", \"Spell\", \"Spire\", \"Weaver\" ],\r\n    \"FishingRod\" : [\"Bane\", \"Beam\", \"Branch\", \"Call\", \"Chant\", \"Cry\", \"Gnarl\", \"Goad\", \"Mast\", \"Pile\", \"Pillar\", \"Pole\", \"Post\", \"Roar\", \"Song\", \"Spell\", \"Spire\", \"Weaver\" ],\r\n    \"Warstaff\" : [\"Bane\", \"Beam\", \"Branch\", \"Call\", \"Chant\", \"Cry\", \"Gnarl\", \"Goad\", \"Mast\", \"Pile\", \"Pillar\", \"Pole\", \"Post\", \"Roar\", \"Song\", \"Spell\", \"Spire\", \"Weaver\" ],\r\n    \"One Hand Sword\" : [\"Bane\", \"Barb\", \"Beak\", \"Bite\", \"Edge\", \"Fang\", \"Gutter\", \"Hunger\", \"Impaler\", \"Needle\", \"Razor\", \"Saw\", \"Scalpel\", \"Scratch\", \"Sever\", \"Skewer\", \"Slicer\", \"Song\", \"Spike\", \"Spiker\", \"Stinger\", \"Thirst\" ],\r\n    \"Thrusting One Hand Sword\" : [\"Bane\", \"Barb\", \"Beak\", \"Bite\", \"Edge\", \"Fang\", \"Gutter\", \"Hunger\", \"Impaler\", \"Needle\", \"Razor\", \"Saw\", \"Scalpel\", \"Scratch\", \"Sever\", \"Skewer\", \"Slicer\", \"Song\", \"Spike\", \"Spiker\",\"Stinger\", \"Thirst\" ],\r\n    \"Two Hand Sword\" : [\"Bane\", \"Barb\", \"Beak\", \"Bite\", \"Edge\", \"Fang\", \"Gutter\", \"Hunger\", \"Impaler\", \"Needle\", \"Razor\", \"Saw\", \"Scalpel\", \"Scratch\", \"Sever\", \"Skewer\", \"Slicer\", \"Song\", \"Spike\", \"Spiker\", \"Stinger\", \"Thirst\" ],\r\n    \"Dagger\" : [\"Bane\", \"Barb\", \"Bite\", \"Edge\", \"Etcher\", \"Fang\", \"Gutter\", \"Hunger\", \"Impaler\", \"Needle\", \"Razor\", \"Scalpel\", \"Scratch\", \"Sever\", \"Skewer\", \"Slicer\", \"Song\", \"Spike\", \"Stinger\", \"Thirst\" ],\r\n    \"Rune Dagger\" : [\"Bane\", \"Barb\", \"Bite\", \"Edge\", \"Etcher\", \"Fang\", \"Gutter\", \"Hunger\", \"Impaler\", \"Needle\", \"Razor\", \"Scalpel\", \"Scratch\", \"Sever\", \"Skewer\", \"Slicer\", \"Song\", \"Spike\", \"Stinger\", \"Thirst\" ],\r\n    \"Claw\" : [\"Bane\", \"Bite\", \"Edge\", \"Fang\", \"Fist\", \"Gutter\", \"Hunger\", \"Impaler\", \"Needle\", \"Razor\", \"Roar\", \"Scratch\", \"Skewer\", \"Slicer\", \"Song\", \"Spike\", \"Stinger\", \"Talons\", \"Thirst\" ],\r\n    \"Bow\" : [\"Arch\", \"Bane\", \"Barrage\", \"Blast\", \"Branch\", \"Breeze\", \"Fletch\", \"Guide\", \"Horn\", \"Mark\", \"Nock\", \"Rain\", \"Reach\", \"Siege\", \"Song\", \"Stinger\", \"Strike\", \"Thirst\", \"Thunder\", \"Twine\", \"Volley\", \"Wind\", \"Wing\" ],\r\n    \"Wand\" : [\"Bane\", \"Barb\", \"Bite\", \"Branch\", \"Call\", \"Chant\", \"Charm\", \"Cry\", \"Edge\", \"Gnarl\", \"Goad\", \"Needle\", \"Scratch\", \"Song\", \"Spell\", \"Spire\", \"Thirst\", \"Weaver\" ],\r\n\r\n    // Armor\r\n    \"Body Armour\" : [\"Carapace\", \"Cloak\", \"Coat\", \"Curtain\", \"Guardian\", \"Hide\", \"Jack\", \"Keep\", \"Mantle\", \"Pelt\", \"Salvation\", \"Sanctuary\", \"Shell\", \"Shelter\", \"Shroud\", \"Skin\", \"Suit\", \"Veil\", \"Ward\", \"Wrap\" ],\r\n    \"Helmet\" : [\"Brow\", \"Corona\", \"Cowl\", \"Crest\", \"Crown\", \"Dome\", \"Glance\", \"Guardian\", \"Halo\", \"Horn\", \"Keep\", \"Peak\", \"Salvation\", \"Shelter\", \"Star\", \"Veil\", \"Visage\", \"Visor\", \"Ward\" ],\r\n    \"Gloves\" : [\"Caress\", \"Claw\", \"Clutches\", \"Fingers\", \"Fist\", \"Grasp\", \"Grip\", \"Hand\", \"Hold\", \"Knuckle\", \"Mitts\", \"Nails\", \"Palm\", \"Paw\", \"Talons\", \"Touch\", \"Vise\" ],\r\n    \"Boots\" : [\"Dash\", \"Goad\", \"Hoof\", \"League\", \"March\", \"Pace\", \"Road\", \"Slippers\", \"Sole\", \"Span\", \"Spark\", \"Spur\", \"Stride\", \"Track\", \"Trail\", \"Tread\", \"Urge\" ],\r\n    // These share the 'Shield' item class, have to search for the 'focus' tag on the item\r\n    \"_Spirit Shield\" : [\"Ancient\", \"Anthem\", \"Call\", \"Chant\", \"Charm\", \"Emblem\", \"Guard\", \"Mark\", \"Pith\", \"Sanctuary\", \"Song\", \"Spell\", \"Star\", \"Ward\", \"Weaver\", \"Wish\" ],\r\n    \"_Other Shield\" : [\"Aegis\", \"Badge\", \"Barrier\", \"Bastion\", \"Bulwark\", \"Duty\", \"Emblem\", \"Fend\", \"Guard\", \"Mark\", \"Refuge\", \"Rock\", \"Rook\", \"Sanctuary\", \"Span\", \"Tower\", \"Watch\", \"Wing\" ],\r\n\r\n    // Accessories\r\n    \"Amulet\" : [\"Beads\", \"Braid\", \"Charm\", \"Choker\", \"Clasp\", \"Collar\", \"Idol\", \"Gorget\", \"Heart\", \"Locket\", \"Medallion\", \"Noose\", \"Pendant\", \"Rosary\", \"Scarab\", \"Talisman\", \"Torc\" ],\r\n    \"Ring\" : [\"Band\", \"Circle\", \"Coil\", \"Eye\", \"Finger\", \"Grasp\", \"Grip\", \"Gyre\", \"Hold\", \"Knot\", \"Knuckle\", \"Loop\", \"Nail\", \"Spiral\", \"Turn\", \"Twirl\", \"Whorl\" ],\r\n    \"Belt\" : [\"Bind\", \"Bond\", \"Buckle\", \"Clasp\", \"Cord\", \"Girdle\", \"Harness\", \"Lash\", \"Leash\", \"Lock\", \"Locket\", \"Shackle\", \"Snare\", \"Strap\", \"Tether\", \"Thread\", \"Trap\", \"Twine\" ],\r\n    \"Quiver\" : [\"Arrow\", \"Barb\", \"Bite\", \"Bolt\", \"Brand\", \"Dart\", \"Flight\", \"Hail\", \"Impaler\", \"Nails\", \"Needle\", \"Quill\", \"Rod\", \"Shot\", \"Skewer\", \"Spear\", \"Spike\", \"Spire\", \"Stinger\" ],\r\n\r\n    // No source for this! Just pulling some random names off poe.trade\r\n    \"Jewel\" : [\"Bliss\", \"Bloom\", \"Creed\", \"Cut\", \"Delirium\", \"Dream\", \"Edge\", \"Essence\", \"Eye\", \"Fist\", \"Glisten\", \"Gnash\", \"Heart\", \"Horn\", \"Hunger\", \"Ichor\", \"Impaler\", \"Joy\", \"Needle\", \"Nock\", \"Ornament\", \"Pause\", \"Prism\", \"Roar\", \"Ruin\", \"Scratch\", \"Shard\", \"Shine\", \"Sliver\", \"Solace\", \"Spiker\", \"Splinter\", \"Stone\", \"Thunder\", \"Wound\" ],\r\n    \"AbyssJewel\" : [\"Bliss\", \"Bloom\", \"Creed\", \"Cut\", \"Delirium\", \"Dream\", \"Edge\", \"Essence\", \"Eye\", \"Fist\", \"Glisten\", \"Gnash\", \"Heart\", \"Horn\", \"Hunger\", \"Ichor\", \"Impaler\", \"Joy\", \"Needle\", \"Nock\", \"Ornament\", \"Pause\", \"Prism\", \"Roar\", \"Ruin\", \"Scratch\", \"Shard\", \"Shine\", \"Sliver\", \"Solace\", \"Spiker\", \"Splinter\", \"Stone\", \"Thunder\", \"Wound\" ],\r\n};\r\n\r\nexport function GenerateRareName(itemData, rng) {\r\n    const prefixIdx = Math.floor(rng() * RarePrefixes.length);\r\n    const prefix = RarePrefixes[prefixIdx];\r\n    let suffixPool = [];\r\n    if (itemData[\"item_class\"] === \"Shield\") {\r\n        if (itemData[\"tags\"].includes(\"focus\")) {\r\n            suffixPool = RareSuffixes[\"_Spirit Shield\"];\r\n        }\r\n        else {\r\n            suffixPool = RareSuffixes[\"_Other Shield\"];\r\n        }\r\n    }\r\n    else {\r\n        suffixPool = RareSuffixes[itemData[\"item_class\"]];\r\n    }\r\n    const suffixIdx = Math.floor(rng() * suffixPool.length);\r\n    const suffix = suffixPool[suffixIdx];\r\n    return prefix + \" \" + suffix;\r\n}\r\n\r\nexport default { GenerateRareName };","// export class ModGroupTree {\r\n//     constructor() {\r\n//         this.domains = {};\r\n//     }\r\n\r\n//     add(modId, domain, group, type, positiveWeightTags, zeroWeightTags) {\r\n//         // { domains : { <domain_str> : <groupset> } }\r\n//         // <groupset> = { <group_str> : <typeset> }\r\n//         // <typeset>  = { <type_str> : { positiveTags : <tagset>, zeroTags : <tagset> } }\r\n//         // <tagset>   = { <tag_str> : [ <modId> ... ] }\r\n//         if (!(domain in this.domains)) {\r\n//             this.domains[domain] = {};\r\n//         }\r\n//         let groupSet = this.domains[domain];\r\n//         if (!(group in groupSet)) {\r\n//             groupSet[group] = {};\r\n//         }\r\n//         let typeSet = groupSet[group];\r\n//         if (!(type in typeSet)) {\r\n//             typeSet[type] = { positiveTags : {}, zeroTags: {} };\r\n//         }\r\n//         let positiveTagSet = typeSet[type].positiveTags;\r\n//         let zeroTagSet = typeSet[type].zeroTags;\r\n//         for (let tag of positiveWeightTags) {\r\n//             if (!(tag in positiveTagSet)) {\r\n//                 positiveTagSet[tag] = [];\r\n//             }\r\n//             positiveTagSet[tag].push(modId);\r\n//         }\r\n//         for (let tag of zeroWeightTags) {\r\n//             if (!(tag in zeroTagSet)) {\r\n//                 zeroTagSet[tag] = [];\r\n//             }\r\n//             zeroTagSet[tag].push(modId);\r\n//         }\r\n//     }\r\n// }\r\n\r\n// export class ModGroupSet {\r\n//     constructor() { \r\n//         this.groupSets = {};\r\n//     }\r\n\r\n//     add(modId, domain, group, type) {\r\n//         const key = domain + \"|\" + group + \"|\" + type;\r\n//         if (!(key in this.groupSets)) {\r\n//             this.groupSets[key] = [ modId ];\r\n//         }\r\n//         else {\r\n//             this.groupSets[key].push(modId);\r\n//         }\r\n//     }\r\n// }\r\n\r\nexport class ModLookupTables {\r\n    constructor() {\r\n        this.domainTable = {};\r\n        this.groupedModTable = {};\r\n        this.statLineIndices = {};\r\n        this.tags = {};\r\n    }\r\n\r\n    add(modId, domain, group, type, statLineIndices, tags) {\r\n        this.addToDomainTable(modId, domain);\r\n        this.addToGroupedModTable(modId, domain, group, type, statLineIndices);\r\n        this.addStatLineIndices(modId, statLineIndices);\r\n        this.addTags(modId, tags);\r\n    }\r\n\r\n    addStatLineIndices(modId, statLineIndices)\r\n    {\r\n        this.statLineIndices[modId] = statLineIndices;\r\n    }\r\n\r\n    addTags(modId, tags) \r\n    {\r\n        this.tags[modId] = tags;\r\n    }\r\n\r\n    addToDomainTable(modId, domain) {\r\n        if (!(domain in this.domainTable)) {\r\n            this.domainTable[domain] = [modId];\r\n        }\r\n        else {\r\n            this.domainTable[domain].push(modId);\r\n        }\r\n    }\r\n\r\n    addToGroupedModTable(modId, domain, group, type, statIndices) {\r\n        const key = this.getGroupedTableKey(domain, group, type, statIndices);\r\n        if (!(key in this.groupedModTable)) {\r\n            this.groupedModTable[key] = [ modId ];\r\n        }\r\n        else {\r\n            this.groupedModTable[key].push(modId);\r\n        }\r\n    }\r\n\r\n    getDomainTable(domain) {\r\n        return this.domainTable[domain];\r\n    }\r\n\r\n    getGroupedTable(domain, group, type, statIndices) {\r\n        return this.groupedModTable[this.getGroupedTableKey(domain, group, type, statIndices)];\r\n    }\r\n\r\n    getGroupedTableKey(domain, group, type, statIndices) {\r\n        return domain + \"|\" + group + \"|\" + type + \"|\" + statIndices.join(\"|\");\r\n    }\r\n\r\n    getGroupedTableKeyForMod(modId, modData) {\r\n        return this.getGroupedTableKey(modData[\"domain\"], modData[\"group\"], modData[\"type\"], this.getStatLineIndices(modId));\r\n    }\r\n\r\n    getStatLineIndices(modId) {\r\n        return this.statLineIndices[modId];\r\n    }\r\n\r\n    getTags(modId) {\r\n        return this.tags[modId];\r\n    }\r\n}\r\n\r\n// export class ModGroup {\r\n//     constructor(domain, group, type, positiveWeightTags, zeroWeightTags) {\r\n//         this.domain = domain;\r\n//         this.group = group;\r\n//         this.type = type;\r\n//         this.positiveWeightTags = new Set(positiveWeightTags);\r\n//         this.zeroWeightTags = new Set(zeroWeightTags);\r\n\r\n//         this.modIds = [];\r\n//     }\r\n\r\n//     equivalent(other) {\r\n//         return (other.domain == this.domain\r\n//             && other.group == this.group\r\n//             && other.type == this.type\r\n//             && this.setsCompatible(other.positiveWeightTags, this.positiveWeightTags)\r\n//             && this.setsCompatible(other.zeroWeightTags, this.zeroWeightTags)\r\n//         );\r\n//     }\r\n\r\n//     setsCompatible(a, b) {\r\n//         /*\r\n//         if (a.size !== b.size) {\r\n//             return false;\r\n//         }\r\n//         */\r\n//         for (const _a of a) {\r\n//             if (!b.has(_a)) {\r\n//                 return false;\r\n//             }\r\n//         }\r\n//         for (const _b of b) {\r\n//             if (!a.has(_b)) {\r\n//                 return false;\r\n//             }\r\n//         }\r\n//         return true;\r\n//     }\r\n// }\r\n\r\nexport function ParseModGroups(mods, stats, mod_types) {\r\n    let modLookupTables = new ModLookupTables();\r\n\r\n    let statKeyToIndex = {};\r\n    let idx = 0;\r\n    for (let statKey in stats) {\r\n        statKeyToIndex[statKey] = idx;\r\n        idx++;\r\n    }\r\n\r\n    for (const modId in mods) {\r\n        const mod = mods[modId];\r\n        let statIndices = [];\r\n        for (const stat of mod[\"stats\"]) {\r\n            statIndices.push(statKeyToIndex[stat.id]);\r\n        }\r\n        let modTags = [ ...mod_types[mod[\"type\"]][\"tags\"] ];\r\n        modLookupTables.add(modId, mod[\"domain\"], mod[\"group\"], mod[\"type\"], statIndices, modTags);\r\n\r\n        // // Filter mods from unaccepted domains\r\n        // if (!validModDomains.has(mod[\"domain\"])) {\r\n        //     continue;\r\n        // }\r\n\r\n        // if (!validModGenerationTypes.has(mod[\"generation_type\"])) {\r\n        //     continue;\r\n        // }\r\n        \r\n        // let positiveWeightTags = [];\r\n        // let zeroWeightTags = [];\r\n        // for (const spawnWeight of mod[\"spawn_weights\"]) {\r\n        //     if (spawnWeight[\"weight\"] > 0) {\r\n        //         positiveWeightTags.push(spawnWeight[\"tag\"]);\r\n        //     }\r\n        //     else {\r\n        //         zeroWeightTags.push(spawnWeight[\"tag\"]);\r\n        //     }\r\n        // }\r\n\r\n        // // Filter un-rollable mods\r\n        // if (positiveWeightTags.length == 0) {\r\n        //     continue;\r\n        // }\r\n\r\n        // modGroupTree.add(modId, mod[\"domain\"], mod[\"group\"], mod[\"type\"], positiveWeightTags, zeroWeightTags);\r\n        // modGroupSet.add(modId, mod[\"domain\"], mod[\"group\"], mod[\"type\"]);\r\n\r\n        // let candidateModGroup = new ModGroup(mod[\"domain\"], mod[\"group\"], mod[\"type\"], positiveWeightTags, zeroWeightTags);\r\n        // let existingModGroup = null;\r\n        // for (let testExistingModGroup of modGroups) {\r\n        //     if (testExistingModGroup.equivalent(candidateModGroup)) {\r\n        //         existingModGroup = testExistingModGroup;\r\n        //         break;\r\n        //     }\r\n        // }\r\n        // if (existingModGroup === null) {\r\n        //     candidateModGroup.modIds.push(modId);\r\n        //     modGroups.push(candidateModGroup);\r\n        // }\r\n        // else {\r\n        //     existingModGroup.modIds.push(modId);\r\n        // }\r\n    }\r\n\r\n    // for (const modGroup of modGroups) {\r\n    //     console.log(\"{\" + modGroup.domain + \" \" + modGroup.group + \" \" + modGroup.type + \" +\" + modGroup.positiveWeightTags + \" -\" + modGroup.zeroWeightTags + \"} : \" + modGroup.modIds.length);\r\n    //     for (const modId of modGroup.modIds) {\r\n    //         console.log(\" - \" + modId);\r\n    //     }\r\n    // }\r\n    return modLookupTables;\r\n}\r\n\r\nexport default { ParseModGroups };","import React from 'react';\r\nimport './App.css';\r\nimport TranslationHelper from './Translation.js';\r\nimport seedrandom from 'seedrandom';\r\nimport RareItemNames from './RareItemnames.js';\r\nimport ModGroups from './ModGroups.js';\r\n\r\nimport base_items from './data/base_items.json';\r\nimport item_classes from './data/item_classes.json';\r\nimport fossils from './data/fossils.json';\r\nimport _mods from './data/mods.json';\r\nimport mod_types from './data/mod_types.json';\r\nimport stat_translations from './data/stat_translations.json';\r\nimport stats from './data/stats.json'\r\n\r\nfunction randRange(rng, minInclusive, maxInclusive) {\r\n  return Math.floor(rng.quick() * (maxInclusive - minInclusive + 1)) + minInclusive;\r\n}\r\n\r\nfunction PropertyLine (props) {\r\n  let replacementIdx = 0;\r\n  let replacementSpans = props.values.map((x) => <span className=\"property\" key={replacementIdx++}>{x}</span>);\r\n  const lineSplit = props.line.split(/{}/g);\r\n  let output = [];\r\n  for (let i = 0; i < lineSplit.length - 1; ++i) {\r\n    output.push(lineSplit[i]);\r\n    output.push(replacementSpans[i]);\r\n  }\r\n  output.push(lineSplit[lineSplit.length - 1]);\r\n  return <div className=\"propertyLine\">{output}</div>;\r\n}\r\n\r\nfunction TipLine (props) {\r\n  return <div className=\"tipLine\">{props.line}</div>\r\n}\r\n\r\nfunction ModLine (props) {\r\n  return <div className=\"modLine\">{props.line}</div>\r\n}\r\n\r\nfunction ItemNameLine (props) {\r\n  return [props.topLine && <div className=\"itemName\" key=\"itemName_top\">{props.topLine}</div>, props.bottomLine && <div className=\"itemName\" key=\"itemName_bottom\">{props.bottomLine}</div>];\r\n}\r\n\r\nfunction ItemHeader (props) {\r\n  const double = props.generatedName.length > 0 && props.itemTypeName.length > 0;\r\n  const leftSymbolClass = props.influences.length > 0 ? props.influences[0] : \"\";\r\n  const rightSymbolClass = props.influences.length > 1 ? props.influences[1] : leftSymbolClass;\r\n  return  <div className={\"header-border \" + (double ? \"double\" : \"single\")}>\r\n            <span className={\"l symbol \" + leftSymbolClass}></span>\r\n            <ItemNameLine topLine={props.generatedName} bottomLine={props.itemTypeName} key=\"nameLine\"/>\r\n            <span className={\"r symbol \" + rightSymbolClass}></span>\r\n          </div>\r\n  ;\r\n}\r\n\r\nclass CraftedItem extends React.Component {\r\n  getItemTypeName() {\r\n    return base_items[this.props.itemState.baseItemId][\"name\"];\r\n  }\r\n\r\n  getTipLine(modInstance, generationType) {\r\n    const mod = this.props.context.mods[modInstance.id];\r\n    let line = \"\";\r\n    if (generationType === \"prefix\" || generationType === \"suffix\") {\r\n      line = generationType[0].toUpperCase() + generationType.slice(1) + \" Modifier \\\"\" + mod[\"name\"] + \"\\\"\" + (modInstance.tierCount > 0 ? (\" (Tier: \" + (modInstance.tier + 1) + \" [\" + (modInstance.tierCount - modInstance.tierCountAtItemLevel + 1) + \"-\" + modInstance.tierCount + \"])\") : \"\");\r\n    }\r\n    else if (generationType === \"unique\" || generationType === \"implicit\") {\r\n      line = generationType[0].toUpperCase() + generationType.slice(1) + \" Modifier\";\r\n    }\r\n    return <TipLine line={line} key={modInstance.id + \"_tip\"}/>;\r\n  }\r\n\r\n  getStatLines(modInstance) {\r\n    const mod = this.props.context.mods[modInstance.id];\r\n    const values = modInstance.values;\r\n    const translationStrings = TranslationHelper.TranslateMod(stat_translations, mod, values);    \r\n    return translationStrings.map((x, i) => <ModLine line={x} key={modInstance.id + \"_mod_\" + i}/>);\r\n  }\r\n\r\n  getImplicitLine(modInstance) {\r\n    const statLines = this.getStatLines(modInstance);\r\n    if (statLines.length > 0) {\r\n      return [this.getTipLine(modInstance, \"implicit\"), this.getStatLines(modInstance)];\r\n    }\r\n  }\r\n\r\n  getImplicitBoxes() {\r\n    let showMods = this.props.itemState.implicits;\r\n    if (this.props.sortMods) {\r\n      showMods = SortMods(showMods, this.props.context);\r\n    }\r\n    return showMods.map(\r\n      x => <div className=\"modBox implicit\" key={x.id}>{this.getImplicitLine(x)}</div>\r\n    );\r\n  }\r\n\r\n  getAffixLine(modInstance) {\r\n    return [this.getTipLine(modInstance, this.props.context.mods[modInstance.id][\"generation_type\"]), this.getStatLines(modInstance)];\r\n  }\r\n\r\n  getAffixBoxes() {\r\n    let showMods = this.props.itemState.affixes;\r\n    if (this.props.sortMods) {\r\n      showMods = SortMods(showMods, this.props.context);\r\n    }\r\n    return showMods.map(    \r\n      x => <div className=\"modBox\" key={x.id}>{this.getAffixLine(x)}</div>\r\n    );\r\n  }\r\n\r\n  getGroupsWithSeparators(groups) \r\n  {\r\n    let separatedGroups = [];\r\n    let separatoridx = 0;\r\n    for (const group of groups) {\r\n      if (group.length > 0) {\r\n        separatedGroups.push(<div className=\"separator\" key={\"sep_\" + separatoridx} />);\r\n        separatoridx++;\r\n        separatedGroups = separatedGroups.concat(group);\r\n      }\r\n    }\r\n    return separatedGroups;\r\n  }\r\n\r\n  render() {\r\n    return <div className={\"craftedItem \" + this.props.itemState.rarity}>\r\n      <div className=\"content-box\">\r\n        <ItemHeader itemTypeName={this.getItemTypeName()} generatedName={this.props.itemState.generatedName} influences={this.props.itemState.influences} />\r\n        <PropertyLine line=\"Item Level: {}\" values={[this.props.itemState.level]} />\r\n        { this.getGroupsWithSeparators([this.getImplicitBoxes(), this.getAffixBoxes()]) }\r\n      </div>\r\n    </div>\r\n  }\r\n}\r\n\r\nfunction ModListLine(props) {\r\n  let spanIdx = 0;\r\n  let nameLineElements = props.nameLines.map( (x) => <span key={spanIdx++}>{x}</span>);\r\n  for (let i = 1; i < nameLineElements.length; i += 2) {\r\n    nameLineElements.splice(i, 0, <br key={\"br_\" + i}/>);\r\n  }\r\n  return <div className={props.lineClass}>\r\n    <div className=\"modTier\" key=\"modTier\">\r\n      { props.tierString }\r\n    </div>\r\n    <div className=\"modName\" key=\"modName\">\r\n      { nameLineElements }\r\n    </div>\r\n    <div className=\"modWeight\" key=\"modWeight\">\r\n      { props.weight }\r\n    </div>\r\n    <div className=\"modProb\" key=\"modProb\">\r\n      { props.prob }\r\n    </div>\r\n  </div>;\r\n}\r\n\r\nclass ModList extends React.Component {\r\n  renderModsInModGroup(modAndWeightGroup, totalWeight) {\r\n    return modAndWeightGroup.map((x) => {\r\n      const modData = this.props.context.mods[x.modId];\r\n      const modWeight = x.weight;\r\n      const modName = TranslationHelper.TranslateMod(stat_translations, modData);\r\n      const modTierInfo = GetTierForMod(this.props.itemState, x.modId, this.props.context);\r\n      return <ModListLine lineClass=\"modLine\" tierString={modData[\"generation_type\"].slice(0, 1) + (modTierInfo[0] + 1)} nameLines={modName} weight={modWeight} prob={(modWeight / totalWeight).toLocaleString(undefined, {style: 'percent', minimumFractionDigits: 2})} key={x.modId} />\r\n    });\r\n  }\r\n\r\n  renderModGroup(modAndWeightGroup, totalWeight, collapsed) {\r\n    const groupWeight = modAndWeightGroup.reduce((total, value) => { return total + value.weight }, 0);\r\n    const groupName = TranslationHelper.TranslateModForGroup(stat_translations, this.props.context.mods[modAndWeightGroup[0].modId]);\r\n    const elementList = [<ModListLine tierString = { collapsed ? \"\" : \"\" } lineClass=\"modGroupLine\" nameLines={groupName} weight={groupWeight} prob={(groupWeight / totalWeight).toLocaleString(undefined, {style: 'percent', minimumFractionDigits: 2})} key={groupName} />];\r\n    elementList.push(...this.renderModsInModGroup(modAndWeightGroup, totalWeight));\r\n    return <div className=\"modGroup\" key={modAndWeightGroup[0].modId}>\r\n      {\r\n        elementList\r\n      }\r\n      </div>\r\n  }\r\n\r\n  render() {\r\n    let modsAndWeights = null;\r\n    // TODO: Expand this to handle any mode\r\n    if (this.props.fossilTypes && this.props.fossilTypes.length > 0) {\r\n      const weightParameters = GetWeightParametersForFossils(this.props.fossilTypes);\r\n      modsAndWeights = GetValidModsAndWeightsForItem(this.props.itemState, this.props.context, { ...weightParameters, ignoreAffixLimits : true, ignoreExistingGroups : true }).sort((a, b) => { return ModIdComparer(a.modId, b.modId, this.props.context) });      \r\n    }\r\n    else {\r\n      modsAndWeights = GetValidModsAndWeightsForItem(this.props.itemState, this.props.context, { rarityOverride : \"rare\" }).sort((a, b) => { return ModIdComparer(a.modId, b.modId, this.props.context) });\r\n    }\r\n\r\n    const totalWeight = modsAndWeights.reduce( (total, value) => { return total + value.weight }, 0);\r\n    let modGroups = [];\r\n    let currentGroupIdx = -1;\r\n    let currentGroupTableKey = \"\";\r\n    for (let modIdx = 0; modIdx < modsAndWeights.length; ++modIdx) {\r\n      const modId = modsAndWeights[modIdx].modId;\r\n      const groupedTableKey = this.props.context.modLookupTables.getGroupedTableKeyForMod(modId, this.props.context.mods[modId]);\r\n      if (groupedTableKey !== currentGroupTableKey) {\r\n        currentGroupIdx++;\r\n        currentGroupTableKey = groupedTableKey;\r\n        modGroups.push([]);\r\n      }\r\n      modGroups[currentGroupIdx].push(modsAndWeights[modIdx]);\r\n    }\r\n\r\n    return <div className=\"modList\">\r\n      {\r\n      modGroups.map((modAndWeightGroup) => { \r\n          { return this.renderModGroup(modAndWeightGroup, totalWeight, false) }\r\n      })\r\n      }\r\n  </div>\r\n  }\r\n}\r\n\r\n\r\nfunction CanBaseItemHaveRarity(baseItemId, rarity) {\r\n  const baseItem = base_items[baseItemId];\r\n  if (baseItem[\"domain\"] === \"flask\") {\r\n    return rarity !== \"rare\";\r\n  }\r\n  return true;\r\n}\r\n\r\nfunction GetSpawnWeightForMod(modId, tags, context) {\r\n  const mod = context.mods[modId];\r\n  for (const spawnWeight of mod[\"spawn_weights\"]) {\r\n    if (tags.includes(spawnWeight[\"tag\"])) {\r\n      return spawnWeight[\"weight\"];\r\n    }\r\n  }\r\n  return 0;\r\n}\r\n\r\nfunction GetPrefixCount(itemState, context) {\r\n  let existingAffixCount = 0;\r\n  for (let i = 0; i < itemState.affixes.length; ++i) {\r\n    const affix = context.mods[itemState.affixes[i].id];\r\n    if (affix[\"generation_type\"] === \"prefix\") {\r\n      existingAffixCount++;\r\n    }\r\n  }\r\n  return existingAffixCount;\r\n}\r\n\r\nfunction GetSuffixCount(itemState, context) {\r\n  let existingAffixCount = 0;\r\n  for (let i = 0; i < itemState.affixes.length; ++i) {\r\n    const affix = context.mods[itemState.affixes[i].id];\r\n    if (affix[\"generation_type\"] === \"suffix\") {\r\n      existingAffixCount++;\r\n    }\r\n  }\r\n  return existingAffixCount;\r\n}\r\n\r\nfunction GetAffixCount(itemState, context) {\r\n  return GetPrefixCount(itemState, context) + GetSuffixCount(itemState, context);\r\n}\r\n\r\nfunction GetPrefixLimitForRarity(baseItemId, rarity) {\r\n  if (rarity === \"normal\") {\r\n    return 0;\r\n  }\r\n  if (rarity === \"magic\") {\r\n    return 1;\r\n  }\r\n  if (rarity === \"rare\" || rarity === \"unique\") {\r\n    const baseItem = base_items[baseItemId];\r\n    if (baseItem[\"domain\"] === \"misc\" || baseItem[\"domain\"] === \"abyss_jewel\") {\r\n      return 2;\r\n    }\r\n    return 3;\r\n  }\r\n  return 0;\r\n}\r\n\r\nfunction GetSuffixLimitForRarity(baseItemId, rarity) {\r\n  return GetPrefixLimitForRarity(baseItemId, rarity);\r\n}\r\n\r\nfunction GetAffixLimitForRarity(baseItemId, rarity) {\r\n  return GetPrefixLimitForRarity(baseItemId, rarity) + GetSuffixLimitForRarity(baseItemId, rarity);\r\n}\r\n\r\nfunction GetPrefixLimit(itemState) {\r\n  return GetPrefixLimitForRarity(itemState.baseItemId, itemState.rarity);\r\n}\r\n\r\nfunction GetSuffixLimit(itemState) {\r\n  return GetSuffixLimitForRarity(itemState.baseItemId, itemState.rarity);\r\n}\r\n\r\nfunction GetAffixLimit(itemState) {\r\n  return GetAffixLimitForRarity(itemState.baseItemId, itemState.rarity); \r\n}\r\n\r\nfunction CanModBeAddedToItem(modId, itemState, context, hasPrefixSlots, hasSuffixSlots, existingModGroups) {\r\n  const mod = context.mods[modId];\r\n\r\n  /*\r\n  const baseItem = base_items[itemState.baseItemId];\r\n  if (mod[\"domain\"] !== baseItem[\"domain\"]) {\r\n    return false;\r\n  }\r\n  */\r\n\r\n  if (mod[\"required_level\"] > itemState.level) {\r\n    return false;\r\n  }\r\n\r\n  if ((mod[\"generation_type\"] === \"prefix\")) {\r\n    if(!hasPrefixSlots) {\r\n      return false;\r\n    }\r\n  }\r\n  else if (mod[\"generation_type\"] === \"suffix\") {\r\n    if (!hasSuffixSlots) {\r\n      return false;\r\n    }\r\n  }\r\n  else {\r\n    return false;\r\n  }\r\n\r\n  const modGroup = mod[\"group\"];\r\n  if (modGroup && modGroup !== \"\") {\r\n    if (existingModGroups.has(modGroup)) {\r\n      return false;\r\n    }\r\n  }\r\n  return true;\r\n}\r\n\r\nfunction GetValidModsAndWeightsForItem(itemState, context, extendedParameters) {\r\n  let validMods = [];\r\n\r\n  const tags = GetItemTags(itemState, context);\r\n\r\n  const rarity = (\"rarityOverride\" in extendedParameters) ? extendedParameters.rarityOverride : itemState.rarity;\r\n  const ignoreAffixLimits = (\"ignoreAffixLimits\" in extendedParameters) ? extendedParameters.ignoreAffixLimits : false;\r\n  const requiredPositiveWeightTag = (\"requiredPositiveWeightTag\" in extendedParameters) ? extendedParameters.requiredPositiveWeightTag : null;\r\n  const negativeWeightMultipliers = (\"negativeWeightMultipliers\" in extendedParameters) ? extendedParameters.negativeWeightMultipliers : null;\r\n  const positiveWeightMultipliers = (\"positiveWeightMultipliers\" in extendedParameters) ? extendedParameters.positiveWeightMultipliers : null;\r\n  const ignoreExistingGroups = (\"ignoreExistingGroups\" in extendedParameters) ? extendedParameters.ignoreExistingGroups : false;\r\n  const addedMods = (\"addedMods\" in extendedParameters) ? extendedParameters.addedMods : null;\r\n\r\n  const hasPrefixSlots = ignoreAffixLimits || (GetPrefixLimitForRarity(itemState.baseItemId, rarity) > GetPrefixCount(itemState, context));\r\n  const hasSuffixSlots = ignoreAffixLimits || (GetSuffixLimitForRarity(itemState.baseItemId, rarity) > GetSuffixCount(itemState, context));\r\n  let existingModGroups = new Set();\r\n  if (!ignoreExistingGroups)\r\n  {\r\n    for (const affix of itemState.affixes) {\r\n      const existingMod = context.mods[affix.id];\r\n      existingModGroups.add(existingMod[\"group\"]);\r\n    }\r\n  }\r\n\r\n  let modIds = context.modLookupTables.getDomainTable(base_items[itemState.baseItemId][\"domain\"]);\r\n  if (addedMods) {\r\n    modIds = [...modIds, ...addedMods];\r\n  }\r\n\r\n  for (const modId of modIds) {\r\n    if (requiredPositiveWeightTag) {\r\n      const mod = context.mods[modId];\r\n      if (!(mod[\"spawn_weights\"].find(x => x[\"tag\"] === requiredPositiveWeightTag && x[\"weight\"] > 0))) {\r\n        continue;\r\n      }\r\n    }\r\n\r\n    if (!CanModBeAddedToItem(modId, itemState, context, hasPrefixSlots, hasSuffixSlots, existingModGroups)) {\r\n      continue;\r\n    }\r\n\r\n    let spawnWeight = GetSpawnWeightForMod(modId, tags, context);\r\n    if (spawnWeight <= 0) {\r\n      continue;\r\n    }\r\n\r\n    if (negativeWeightMultipliers) {\r\n      const modTags = context.modLookupTables.getTags(modId);\r\n      for (const modTag of modTags) {\r\n        if (modTag in negativeWeightMultipliers) {\r\n          spawnWeight = spawnWeight * negativeWeightMultipliers[modTag];\r\n        }\r\n      }\r\n\r\n      if (spawnWeight <= 0) {\r\n        continue;\r\n      }\r\n    }\r\n\r\n    if (positiveWeightMultipliers) {\r\n      //   NOTE - It's not clear to me how the game handles multiple applicable positive weight multipliers\r\n      //\r\n      // For example, if you apply both Aberrant (+chaos:10x) and Serrated (+attack:10x) on the AddedChaosSuffix\r\n      // mod (attack, chaos), is the total multiplication 10 * 10 = 100x? Or 10 + 10 = 20x?\r\n      //\r\n      // It's a little more conservative, but I'm going with the additive option here until proven otherwise.\r\n\r\n      const modTags = context.modLookupTables.getTags(modId);\r\n      let totalPositiveWeightMultiplier = 0;\r\n      for (const modTag of modTags) {\r\n        if (modTag in positiveWeightMultipliers) {\r\n          totalPositiveWeightMultiplier = totalPositiveWeightMultiplier + positiveWeightMultipliers[modTag];\r\n        }\r\n      }\r\n      if (totalPositiveWeightMultiplier > 0) {\r\n        spawnWeight = spawnWeight * totalPositiveWeightMultiplier;\r\n      }\r\n    }\r\n    \r\n    validMods.push({modId: modId, weight: spawnWeight});\r\n  }\r\n  return validMods;\r\n}\r\n\r\nfunction CreateWeightedModPool(modsAndWeights) {\r\n  let modPool = {\r\n    totalWeight : 0,\r\n    mods : []\r\n  }\r\n\r\n  for (const modAndWeight of modsAndWeights) {\r\n    let modWeight = modAndWeight.weight;\r\n    modPool.mods.push({\r\n      id : modAndWeight.modId,\r\n      weight : modWeight\r\n    });\r\n    modPool.totalWeight += modWeight;\r\n  }\r\n\r\n  return modPool;\r\n}\r\n\r\nfunction PickModFromWeightedModPool(modPool, context) {\r\n  const randRoll = randRange(context.rng, 0, modPool.totalWeight - 1);\r\n  let weightAccum = 0;\r\n\r\n  for (const mod of modPool.mods) {\r\n    const modEndWeight = weightAccum + mod.weight;\r\n    if (randRoll < modEndWeight) {\r\n      return mod.id;\r\n    }\r\n    weightAccum = modEndWeight;\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\nfunction GetInfluenceTag(baseItemId, influence) {\r\n  const baseItem = base_items[baseItemId];\r\n  const baseItemClass = baseItem[\"item_class\"];\r\n  if (baseItemClass in item_classes) {\r\n    const influenceTagId = influence + \"_tag\";\r\n    if (influenceTagId in item_classes[baseItemClass]) {\r\n      const influenceTag = item_classes[baseItemClass][influenceTagId];\r\n      if (influenceTag) {\r\n        return influenceTag;\r\n      }\r\n    }\r\n  }\r\n  return null;\r\n}\r\n\r\nfunction GetAddedTags(modId, context) {\r\n  return context.mods[modId][\"adds_tags\"];\r\n}\r\n\r\nfunction GetBaseItemTags (itemState, context) {\r\n  const baseItem = base_items[itemState.baseItemId];\r\n  let tags = [];\r\n  tags = tags.concat(baseItem[\"tags\"]);\r\n  for (const influence of itemState.influences) {\r\n    const influenceTag = GetInfluenceTag(itemState.baseItemId, influence);\r\n    if (influenceTag) {\r\n      tags.push(influenceTag);\r\n    }\r\n  }\r\n  for (const implicit of itemState.implicits) {\r\n    tags = tags.concat(GetAddedTags(implicit.id, context));\r\n  }\r\n  return tags;\r\n}\r\n\r\nfunction GetItemTags(itemState, context) {\r\n  let tags = GetBaseItemTags(itemState, context);\r\n  for (const affix of itemState.affixes) {\r\n    tags = tags.concat(GetAddedTags(affix.id, context));\r\n  }\r\n  return tags;\r\n}\r\n\r\nfunction RollModValues(modId, context) {\r\n  let statRolls = [];\r\n  const mod = context.mods[modId];\r\n  for (const stat of mod[\"stats\"]) {\r\n    statRolls.push(randRange(context.rng, stat[\"min\"], stat[\"max\"]));\r\n  }\r\n  return statRolls;\r\n}\r\n\r\nfunction GetTierForMod(itemState, modId, context) {\r\n  const mod = context.mods[modId];\r\n  if (mod[\"is_essence_only\"]) {\r\n    return [0, 1, 1]\r\n  }\r\n\r\n  if (mod[\"generation_type\"] === \"unique\") {\r\n    return [0, 1, 1]\r\n  }\r\n\r\n  let modTier = 0;\r\n  let modCount = 1;\r\n  let modCountAtItemLevel = 1;\r\n  const modLevel = mod[\"required_level\"];\r\n  const baseItemTags = GetBaseItemTags(itemState, context);\r\n  const otherModIds = context.modLookupTables.getGroupedTable(mod[\"domain\"], mod[\"group\"], mod[\"type\"], context.modLookupTables.getStatLineIndices(modId));\r\n  for (const otherModId of otherModIds) {\r\n    if (otherModId === modId) {\r\n      continue;\r\n    }\r\n\r\n    const otherMod = context.mods[otherModId];\r\n    if (otherMod[\"is_essence_only\"]) {\r\n      continue;\r\n    }\r\n\r\n    if (GetSpawnWeightForMod(otherModId, baseItemTags, context) <= 0) {\r\n      continue;\r\n    }\r\n\r\n    modCount++;\r\n\r\n    if (otherMod[\"required_level\"] <= itemState.level) {\r\n      modCountAtItemLevel++;\r\n    }\r\n\r\n    if (otherMod[\"required_level\"] > modLevel) {\r\n      modTier++;\r\n    }\r\n  }\r\n\r\n  return [modTier, modCount, modCountAtItemLevel];\r\n}\r\n\r\nfunction CreateRolledMod(itemState, modId, context) {\r\n  const tierValues = GetTierForMod(itemState, modId, context);\r\n  return {\r\n    id : modId,\r\n    values : RollModValues(modId, context),\r\n    tier : tierValues[0],\r\n    tierCount : tierValues[1],\r\n    tierCountAtItemLevel : tierValues[2]\r\n  }  \r\n}\r\n\r\nfunction RollRareName(itemState, rng) {\r\n  const itemData = base_items[itemState.baseItemId];\r\n  return RareItemNames.GenerateRareName(itemData, rng);\r\n}\r\n\r\nfunction RollRareAffixCount(baseItemId, rng) {\r\n  const maxAffixCount = GetAffixLimitForRarity(baseItemId, \"rare\");\r\n  if (maxAffixCount === 6) {\r\n    // Number of mods from data mined note (source: POE Discord, #3rd-party-tool-dev)\r\n    // \"1/12 chance for 6 mods, 4/12 chance for 5 mods, and 7/12 chance for 6 mods\"\r\n    const randInt = randRange(rng, 0, 11);\r\n    if (randInt < 7) {\r\n      return 4;\r\n    }\r\n    if (randInt < 11) {\r\n      return 5;\r\n    }\r\n    return 6;\r\n  }\r\n  else if (maxAffixCount === 4) {\r\n    // Number of mods from data mined note (source: reddit, https://www.reddit.com/r/pathofexile/comments/8fxnlu/chance_of_getting_specific_number_of_mods_via/)\r\n    // \"for jewels: 65/35\"\r\n    const randInt = randRange(rng, 0, 99);\r\n    if (randInt < 65) {\r\n      return 3;\r\n    }\r\n    return 4;\r\n  }\r\n  else if (maxAffixCount > 0) {\r\n    // Unexpected situation, roll pure random\r\n    return randRange(rng, 1, maxAffixCount);\r\n  }\r\n  return 0;\r\n}\r\n\r\nfunction cloneMods(modArray) {\r\n  let newArray = Array(modArray.length);\r\n  for (const oldModIdx in modArray) {\r\n    newArray[oldModIdx] = { ...modArray[oldModIdx], values : [ ...modArray[oldModIdx].values ]};\r\n  }\r\n  return newArray;\r\n}\r\n\r\nfunction cloneItemState(itemState) {\r\n  return { \r\n    ...itemState, \r\n    influences : itemState.influences.slice(),\r\n    implicits : cloneMods(itemState.implicits), \r\n    corruptions : cloneMods(itemState.corruptions), \r\n    affixes : cloneMods(itemState.affixes) \r\n  };\r\n}\r\n\r\nfunction CreateItem(baseItemId, level, context) {\r\n  let itemState = {\r\n    generatedName : \"\",\r\n    baseItemId : baseItemId,\r\n    level : level,\r\n    rarity : \"normal\",\r\n    corrupted : false,\r\n    quality : 0,\r\n    influences : [],\r\n    implicits : [],\r\n    corruptions : [],\r\n    affixes : []\r\n  }  \r\n\r\n  // Add and roll implicits\r\n  const baseItem = base_items[baseItemId];\r\n  for (const implicitId of baseItem[\"implicits\"]) {\r\n    itemState.implicits.push(CreateRolledMod(itemState, implicitId, context));\r\n  }\r\n\r\n  return itemState;\r\n}\r\n\r\nfunction AddRandomModFromListAndWeights(itemState, modsAndWeights, context) {\r\n  let newItemState = cloneItemState(itemState);\r\n  const weightedModPool = CreateWeightedModPool(modsAndWeights, context);\r\n  const modId = PickModFromWeightedModPool(weightedModPool, context);\r\n  if (!modId) {\r\n    return [false, itemState];\r\n  }\r\n  newItemState.affixes.push(CreateRolledMod(itemState, modId, context));\r\n  return [true, newItemState];  \r\n}\r\n\r\nfunction AddRandomMod(itemState, context, extendedParameters = {}) {\r\n  let newItemState = cloneItemState(itemState);\r\n  const modsAndWeights = GetValidModsAndWeightsForItem(newItemState, context, extendedParameters);\r\n  return AddRandomModFromListAndWeights(itemState, modsAndWeights, context);\r\n}\r\n\r\nconst generationTypeOrder = {\r\n  \"unique\": 0,\r\n  \"prefix\": 1,\r\n  \"suffix\": 2,\r\n};\r\n\r\nfunction ModIdComparer (a, b, context) {\r\n  const modA = context.mods[a];\r\n  const modB = context.mods[b];\r\n\r\n  const modAGenerationType = modA[\"generation_type\"];\r\n  const modBGenerationType = modB[\"generation_type\"];\r\n  if (modAGenerationType !== modBGenerationType) {\r\n    if (modAGenerationType in generationTypeOrder && modBGenerationType in generationTypeOrder) {\r\n      return generationTypeOrder[modAGenerationType] - generationTypeOrder[modBGenerationType];\r\n    }\r\n    return 0;\r\n  }\r\n\r\n  const aStatIndices = context.modLookupTables.getStatLineIndices(a);\r\n  const bStatIndices = context.modLookupTables.getStatLineIndices(b);\r\n  const aNumStats = aStatIndices.length;\r\n  const bNumStats = bStatIndices.length;\r\n  let statIdx = 0;\r\n  while (statIdx < aNumStats && statIdx < bNumStats) {\r\n    if (aStatIndices[statIdx] !== bStatIndices[statIdx]) {\r\n      return aStatIndices[statIdx] - bStatIndices[statIdx];\r\n    }\r\n    ++statIdx;\r\n  }\r\n  if (aNumStats !== bNumStats) {\r\n    return aNumStats - bNumStats;\r\n  }\r\n\r\n  const modARequiredLevel = modA[\"required_level\"];\r\n  const modBRequiredLevel = modB[\"required_level\"];\r\n  if (modARequiredLevel !== modBRequiredLevel) {\r\n    return -(modARequiredLevel - modBRequiredLevel);\r\n  }\r\n\r\n  return 0;  \r\n}\r\n\r\nfunction ModComparer (a, b, context) {\r\n  return ModIdComparer(a.id, b.id, context);\r\n}\r\n\r\nfunction SortMods(modList, context) {\r\n  let sortedList = cloneMods(modList);\r\n  sortedList.sort((a, b) => { return ModComparer(a, b, context) });\r\n  return sortedList;\r\n}\r\n\r\nfunction CanAddInfluenceToItem(itemState, influence) {\r\n  return GetInfluenceTag(itemState.baseItemId, influence) != null;\r\n}\r\n\r\nfunction AddInfluenceToItem(itemState, influence) {\r\n  if (!CanAddInfluenceToItem(itemState, influence)) {\r\n    return [false, itemState];\r\n  }\r\n\r\n  let newState = cloneItemState(itemState);\r\n  newState.influences.push(influence);\r\n  return [true, newState];\r\n}\r\n\r\n// eslint-disable-next-line no-unused-vars\r\nfunction CanScourItem(itemState, context) {\r\n  if (itemState.rarity === \"normal\") {\r\n    return false;\r\n  }\r\n  if (itemState.rarity === \"unique\") {\r\n    return false;\r\n  }\r\n  if (itemState.corrupted) {\r\n    return false;\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\nfunction ScourItem(itemState, context) {\r\n  if (!CanScourItem(itemState, context)) {\r\n    return [false, itemState];\r\n  }\r\n  return [true, { ...cloneItemState(itemState), generatedName : \"\", rarity : \"normal\", affixes : [] }];\r\n}\r\n\r\n// eslint-disable-next-line no-unused-vars\r\nfunction CanTransmutationItem(itemState, context) {\r\n  if (itemState.rarity !== \"normal\") {\r\n    return false;\r\n  }\r\n  if (itemState.corrupted) {\r\n    return false;\r\n  }\r\n  if (!CanBaseItemHaveRarity(itemState.baseItemId, \"magic\")) {\r\n    return false;\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\nfunction TransmutationItem(itemState, context) {\r\n  if (!CanTransmutationItem(itemState, context)) {\r\n    return [false, itemState];\r\n  }\r\n\r\n  let newItemState = { ...cloneItemState(itemState), rarity : \"magic\" };\r\n  const numMods = randRange(context.rng, 1, 2);\r\n  for (let i = 0; i < numMods; ++i) {\r\n    newItemState = AddRandomMod(newItemState, context)[1];\r\n  }\r\n\r\n  return [true, newItemState];\r\n}\r\n\r\n// eslint-disable-next-line no-unused-vars\r\nfunction CanAlterationItem(itemState, context) {\r\n  if (itemState.rarity !== \"magic\") {\r\n    return false;\r\n  }\r\n  if (itemState.corrupted) {\r\n    return false;\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\nfunction AlterationItem(itemState, context) {\r\n  if (!CanAlterationItem(itemState, context)) {\r\n    return [false, itemState];\r\n  }\r\n\r\n  let newItemState = { ...cloneItemState(itemState), affixes : [] };\r\n  const numMods = randRange(context.rng, 1, 2);\r\n  for (let i = 0; i < numMods; ++i) {\r\n    newItemState = AddRandomMod(newItemState, context)[1];\r\n  }\r\n\r\n  return [true, newItemState];\r\n}\r\n\r\nfunction CanAugmentationItem(itemState, context) {\r\n  if (itemState.rarity !== \"magic\") {\r\n    return false;\r\n  }\r\n  if (itemState.corrupted) {\r\n    return false;\r\n  }\r\n  if (GetAffixCount(itemState, context) >= GetAffixLimit(itemState)) {\r\n    return false;\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\nfunction AugmentationItem(itemState, context) {\r\n  if (!CanAugmentationItem(itemState, context)) {\r\n    return [false, itemState];\r\n  }\r\n\r\n  const [result, newItemState] = AddRandomMod(itemState, context);\r\n  if (!result) {\r\n    return [false, itemState];\r\n  }\r\n  return [true, newItemState];\r\n}\r\n\r\n// eslint-disable-next-line no-unused-vars\r\nfunction CanRegalItem(itemState, context) {\r\n  if (itemState.rarity !== \"magic\") {\r\n    return false;\r\n  }\r\n  if (itemState.corrupted) {\r\n    return false;\r\n  }\r\n  if (!CanBaseItemHaveRarity(itemState.baseItemId, \"rare\")) {\r\n    return false;\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\nfunction RegalItem(itemState, context) {\r\n  if (!CanRegalItem(itemState, context)) {\r\n    return [false, itemState];\r\n  }\r\n\r\n  let rareItemState = { ...cloneItemState(itemState), rarity : \"rare\", generatedName : RollRareName(itemState, context.rng) };\r\n  const [result, newItemState] = AddRandomMod(rareItemState, context);\r\n  if (!result) {\r\n    return [false, itemState];\r\n  }\r\n  return [true, newItemState];\r\n}\r\n\r\n// eslint-disable-next-line no-unused-vars\r\nfunction CanAlchemyItem(itemState, context) {\r\n  if (itemState.rarity !== \"normal\") {\r\n    return false;\r\n  }\r\n  if (itemState.corrupted) {\r\n    return false;\r\n  }\r\n  if (!CanBaseItemHaveRarity(itemState.baseItemId, \"rare\")) {\r\n    return false;\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\nfunction AlchemyItem(itemState, context) {\r\n  if (!CanAlchemyItem(itemState, context)) {\r\n    return [false, itemState];\r\n  }\r\n\r\n  let newItemState = { ...cloneItemState(itemState), rarity : \"rare\", generatedName : RollRareName(itemState, context.rng) };\r\n  const numMods = RollRareAffixCount(itemState.baseItemId, context.rng);\r\n  for (let i = 0; i < numMods; ++i) {\r\n    newItemState = AddRandomMod(newItemState, context)[1];\r\n  }\r\n  newItemState.generatedName = RollRareName(itemState, context.rng);\r\n\r\n  return [true, newItemState];\r\n}\r\n\r\n// eslint-disable-next-line no-unused-vars\r\nfunction CanChaosItem(itemState, context) {\r\n  if (itemState.rarity !== \"rare\") {\r\n    return false;\r\n  }\r\n  if (itemState.corrupted) {\r\n    return false;\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\nfunction ChaosItem(itemState, context) {\r\n  if (!CanChaosItem(itemState, context)) {\r\n    return [false, itemState];\r\n  }\r\n\r\n  let newItemState = { ...cloneItemState(itemState), affixes : [], generatedName : RollRareName(itemState, context.rng)  };\r\n  const numMods = RollRareAffixCount(itemState.baseItemId, context.rng);\r\n  for (let i = 0; i < numMods; ++i) {\r\n    newItemState = AddRandomMod(newItemState, context)[1];\r\n  }\r\n\r\n  return [true, newItemState];\r\n}\r\n\r\nfunction CanExaltedItem(itemState, context) {\r\n  if (itemState.rarity !== \"rare\") {\r\n    return false;\r\n  }\r\n  if (itemState.corrupted) {\r\n    return false;\r\n  }\r\n  if (GetAffixCount(itemState, context) >= GetAffixLimit(itemState)) {\r\n    return false;\r\n  }\r\n  \r\n  return true;\r\n}\r\n\r\nfunction ExaltedItem(itemState, context) {\r\n  if (!CanExaltedItem(itemState, context)) {\r\n    return [false, itemState];\r\n  }\r\n\r\n  const [result, newItemState] = AddRandomMod(itemState, context);\r\n  if (!result) {\r\n    return [false, itemState];\r\n  }\r\n  return [true, newItemState];\r\n}\r\n\r\nfunction CanExaltedWithInfluenceItem(itemState, context, influence) {\r\n  if (itemState.influences.length > 0) {\r\n    return false;\r\n  }\r\n  if (!CanExaltedItem(itemState, context)) {\r\n    return false;\r\n  }\r\n  if (!CanAddInfluenceToItem(itemState, influence)) {\r\n    return false;\r\n  }\r\n\r\n  let [ , newItemState] = AddInfluenceToItem(itemState, influence);\r\n  const influenceTag = GetInfluenceTag(newItemState.baseItemId, influence);\r\n  const validMods = GetValidModsAndWeightsForItem(newItemState, context, { requiredPositiveWeightTag : influenceTag });\r\n  if (validMods.length === 0) {\r\n    return false;\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\nfunction ExaltedWithInfluenceItem(itemState, context, influence) {\r\n  if (!CanExaltedWithInfluenceItem(itemState, context, influence)) {\r\n    return [false, itemState];\r\n  }\r\n\r\n  let [ , newItemState] = AddInfluenceToItem(itemState, influence);\r\n  const influenceTag = GetInfluenceTag(newItemState.baseItemId, influence);\r\n  const validMods = GetValidModsAndWeightsForItem(newItemState, context, { requiredPositiveWeightTag : influenceTag });\r\n  return AddRandomModFromListAndWeights(newItemState, validMods, context);\r\n}\r\n\r\nfunction CanAnnulmentItem(itemState, context) {\r\n  if (itemState.rarity === \"normal\" || itemState.rarity === \"unique\") {\r\n    return false;\r\n  }\r\n  if (itemState.corrupted) {\r\n    return false;\r\n  }\r\n  if (GetAffixCount(itemState, context) === 0) {\r\n    return false;\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\nfunction AnnulmentItem(itemState, context) {\r\n  if (!CanAnnulmentItem(itemState, context)) {\r\n    return [false, itemState];\r\n  }\r\n\r\n  let newItemState = cloneItemState(itemState);\r\n  const numAffixes = GetAffixCount(newItemState, context);\r\n  const affixIdxToRemove = randRange(context.rng, 0, numAffixes - 1);\r\n  newItemState.affixes.splice(affixIdxToRemove, 1);\r\n  return [true, newItemState];\r\n}\r\n\r\n// eslint-disable-next-line no-unused-vars\r\nfunction CanBlessedItem(itemState, context) {\r\n  if (itemState.corrupted) {\r\n    return false;\r\n  }\r\n  if (itemState.implicits.length === 0) {\r\n    return false;\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\nfunction BlessedItem(itemState, context) {\r\n  if (!CanBlessedItem(itemState, context)) {\r\n    return [false, itemState];\r\n  }\r\n\r\n  let newItemState = cloneItemState(itemState);\r\n  for (let implicit of newItemState.implicits) {\r\n    implicit.values = RollModValues(implicit.id, context);\r\n  }\r\n  return [true, newItemState];\r\n}\r\n\r\n// eslint-disable-next-line no-unused-vars\r\nfunction CanDivineItem(itemState, context) {\r\n  if (itemState.corrupted) {\r\n    return false;\r\n  }\r\n  if (itemState.affixes.length === 0) {\r\n    return false;\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\nfunction DivineItem(itemState, context) {\r\n  if (!CanDivineItem(itemState, context)) {\r\n    return [false, itemState];\r\n  }\r\n\r\n  let newItemState = cloneItemState(itemState);\r\n  for (let affix of newItemState.affixes) {\r\n    affix.values = RollModValues(affix.id, context);\r\n  }\r\n  return [true, newItemState];\r\n}\r\n\r\n// eslint-disable-next-line no-unused-vars\r\nfunction CanFossilItem(itemState, context) {\r\n  if (itemState.corrupted) {\r\n    return false;\r\n  }\r\n\r\n  const fossilTypes = Array.prototype.slice.call(arguments, 2);\r\n  if (fossilTypes.length === 0) {\r\n    return false;\r\n  }\r\n\r\n  for (const fossilId of fossilTypes) {\r\n    const fossil = fossils[fossilId];\r\n\r\n    if (fossil[\"allowed_tags\"].length > 0) {\r\n      const baseItem = base_items[itemState.baseItemId];\r\n      let hasAllowedTag = false;\r\n      for (const allowedTag of fossil[\"allowed_tags\"]) {\r\n        if (baseItem[\"tags\"].includes(allowedTag)) {\r\n          hasAllowedTag = true;\r\n          break;\r\n        }\r\n      }\r\n      if (!hasAllowedTag) {\r\n        return false;\r\n      }\r\n    }\r\n\r\n    if (fossil[\"forbidden_tags\"].length > 0) {\r\n      const baseItem = base_items[itemState.baseItemId];\r\n      for (const forbiddenTag of fossil[\"allowed_tags\"]) {\r\n        if (baseItem[\"tags\"].includes(forbiddenTag)) {\r\n          return false;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\nfunction GetWeightParametersForFossils(fossilTypes) {\r\n  let addedMods = [];\r\n  let forcedMods = [];\r\n  let negativeTagMultipliers = {};\r\n  let positiveTagMultipliers = {};\r\n  let rollsLucky = false;\r\n  for (const fossilId of fossilTypes) {\r\n    const fossil = fossils[fossilId];\r\n    addedMods = [ ...addedMods, ...fossil[\"added_mods\"] ];\r\n    for (const negativeWeightMod of fossil[\"negative_mod_weights\"]) {\r\n      const tag = negativeWeightMod[\"tag\"];\r\n      const weightMultiplier = negativeWeightMod[\"weight\"] / 100.0;\r\n      if (tag in negativeTagMultipliers) {\r\n        negativeTagMultipliers[tag] = negativeTagMultipliers[tag] * weightMultiplier;\r\n      }\r\n      else {\r\n        negativeTagMultipliers[tag] = weightMultiplier;\r\n      }\r\n    }\r\n    for (const positiveWeightMod of fossil[\"positive_mod_weights\"]) {\r\n      const tag = positiveWeightMod[\"tag\"];\r\n      const weightMultiplier = positiveWeightMod[\"weight\"] / 100.0;\r\n      if (tag in positiveTagMultipliers) {\r\n        positiveTagMultipliers[tag] = positiveTagMultipliers[tag] + weightMultiplier;\r\n      }\r\n      else {\r\n        positiveTagMultipliers[tag] = weightMultiplier;\r\n      }\r\n    }\r\n    forcedMods = [ ...forcedMods, ...fossil[\"forced_mods\"] ];\r\n    rollsLucky = rollsLucky || fossil[\"rolls_lucky\"];\r\n  }\r\n\r\n  return {\r\n    negativeWeightMultipliers : negativeTagMultipliers,\r\n    positiveWeightMultipliers : positiveTagMultipliers,\r\n    addedMods : addedMods,\r\n  }\r\n}\r\n\r\nfunction FossilItem(itemState, context) {\r\n  if (!CanFossilItem(...arguments)) {\r\n    return [false, itemState];\r\n  }\r\n\r\n  // NOTE - It's not immediately clear to me what the effect of combining\r\n  // two fossils that have conflicting negative and positive mod weights,\r\n  // so for now I'm multiplying them together.\r\n  //\r\n  // For the case of aetheric / serrated, this results in both having a \r\n  // weight multiplier of 1.5, which feels about right. \r\n\r\n  const fossilTypes = Array.prototype.slice.call(arguments, 2);\r\n  const weightParameters = GetWeightParametersForFossils(fossilTypes);\r\n\r\n  const numMods = RollRareAffixCount(itemState.baseItemId, context.rng);\r\n  let newItemState = { ...cloneItemState(itemState), rarity : \"rare\", generatedName : RollRareName(itemState, context.rng), affixes : [] };  \r\n  for (let i = 0; i < numMods; ++i) {\r\n    const validMods = GetValidModsAndWeightsForItem(newItemState, context, weightParameters);\r\n    if (validMods.length === 0) {\r\n      break;\r\n    }\r\n    const result = AddRandomModFromListAndWeights(newItemState, validMods, context);\r\n    if (result[0] == false) {\r\n      break;\r\n    }\r\n    newItemState = result[1];\r\n  }\r\n\r\n  return [true, newItemState];\r\n}\r\n\r\nfunction CraftingButton(props) {\r\n  return <button className=\"button\" onClick={props.onClick} disabled={!props.enabled}>{props.label}</button>;\r\n}\r\n\r\nclass TheoryCrafterContext {\r\n  constructor(modDatabase, rng) {\r\n    this.mods = modDatabase;\r\n    this.modLookupTables = ModGroups.ParseModGroups(modDatabase, stats, mod_types);\r\n    this.rng = rng;\r\n  }\r\n}\r\n\r\nclass TheoryCrafter extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.testMap = {\r\n      \"scour\" : CanScourItem,\r\n      \"transmute\" : CanTransmutationItem,\r\n      \"alt\" : CanAlterationItem,\r\n      \"aug\" : CanAugmentationItem,\r\n      \"regal\" : CanRegalItem,\r\n      \"alch\" : CanAlchemyItem,\r\n      \"chaos\" : CanChaosItem,\r\n      \"exalt\" : CanExaltedItem,\r\n      \"exalt_inf\" : CanExaltedWithInfluenceItem,\r\n      \"annul\" : CanAnnulmentItem,\r\n      \"bless\" : CanBlessedItem,\r\n      \"divine\" : CanDivineItem,\r\n      \"fossil\" : CanFossilItem,\r\n    }\r\n\r\n    this.actionMap = {\r\n      \"scour\" : ScourItem,\r\n      \"transmute\" : TransmutationItem,\r\n      \"alt\" : AlterationItem,\r\n      \"aug\" : AugmentationItem,\r\n      \"regal\" : RegalItem,\r\n      \"alch\" : AlchemyItem,\r\n      \"chaos\" : ChaosItem,\r\n      \"exalt\" : ExaltedItem,\r\n      \"exalt_inf\" : ExaltedWithInfluenceItem,\r\n      \"annul\" : AnnulmentItem,\r\n      \"bless\" : BlessedItem,\r\n      \"divine\" : DivineItem,\r\n      \"fossil\" : FossilItem,\r\n    }\r\n\r\n    this.theoryCrafterContext = new TheoryCrafterContext(_mods, seedrandom());\r\n\r\n    const normalItemState = CreateItem(\"Metadata/Items/Armours/Boots/BootsAtlas1\", 100, this.theoryCrafterContext);\r\n    this.state = this.initState(normalItemState);\r\n  }\r\n\r\n  initState(initItemState) {\r\n    return {\r\n      itemStateHistory : [ { itemState: initItemState, action : \"\" } ],\r\n      itemStateHistoryIdx : 0,\r\n      lastCommand : \"\",\r\n      selectedBaseId : initItemState.baseItemId,\r\n      selectedBaseLevel : initItemState.level,\r\n      sortMods : false,\r\n      selectedFossils : [],\r\n    };\r\n  }\r\n\r\n  pushState(newState, actionName) {\r\n    return { ...this.state, itemStateHistory : [ ...this.state.itemStateHistory, { itemState: newState, action : actionName } ] };\r\n  }\r\n\r\n  getState() {\r\n    return this.state.itemStateHistory[this.state.itemStateHistoryIdx].itemState;\r\n  }\r\n\r\n  canUndoState() {\r\n    return this.state.itemStateHistoryIdx > 0;\r\n  }\r\n\r\n  getUndoLabel() {\r\n    if (!this.canUndoState()) {\r\n      return \"Undo\";\r\n    }\r\n    return \"Undo \" + this.state.itemStateHistory[this.state.itemStateHistoryIdx].action;\r\n  }\r\n\r\n  undoState() {\r\n    if (this.state.itemStateHistoryIdx > 0)\r\n    {\r\n      this.setState({ ...this.state, itemStateHistoryIdx :  this.state.itemStateHistoryIdx - 1 });\r\n    }\r\n  }\r\n\r\n  canRerollAction() {\r\n    return (this.state.itemStateHistory[this.state.itemStateHistoryIdx].action !== \"\") \r\n      && (this.state.itemStateHistoryIdx > 0);\r\n  }\r\n\r\n  getRerollLabel() {\r\n    if (!this.canRerollAction()) {\r\n      return \"Reroll Action\";\r\n    }\r\n    return \"Reroll \" + this.state.itemStateHistory[this.state.itemStateHistoryIdx].action;\r\n  }\r\n\r\n  rerollAction() {\r\n    if (!this.canRerollAction()) {\r\n      return;\r\n    }\r\n    const action = this.state.itemStateHistory[this.state.itemStateHistoryIdx].action;\r\n    const previousItemState = this.state.itemStateHistory[this.state.itemStateHistoryIdx - 1].itemState;\r\n    const canPerformAction = this.canPerformAction(action, previousItemState);\r\n    if (!canPerformAction) {\r\n      return;\r\n    }\r\n    this.performAction(action, previousItemState, this.state.itemStateHistoryIdx);\r\n  }\r\n\r\n  canRedoState() {\r\n    return this.state.itemStateHistoryIdx < this.state.itemStateHistory.length - 1;\r\n  }\r\n\r\n  getRedoLabel() {\r\n    if (!this.canRedoState()) {\r\n      return \"Redo\";\r\n    }\r\n    return \"Redo \" + this.state.itemStateHistory[this.state.itemStateHistoryIdx + 1].action;\r\n  }\r\n\r\n  redoState() {\r\n    if (this.state.itemStateHistoryIdx < this.state.itemStateHistory.length - 1)\r\n    {\r\n      this.setState({ ...this.state, itemStateHistoryIdx :  this.state.itemStateHistoryIdx + 1 });\r\n    }\r\n  }\r\n\r\n  insertAndCutStateAt(newState, actionName, index) {\r\n    const newStateHistory = this.state.itemStateHistory.slice(0, index);\r\n    newStateHistory.push( { itemState: newState, action : actionName } );\r\n    return { ...this.state, itemStateHistory : newStateHistory, itemStateHistoryIdx : index };    \r\n  }\r\n\r\n  insertAndCutState(newState, actionName) {\r\n    return this.insertAndCutStateAt(newState, actionName, this.state.itemStateHistoryIdx + 1);\r\n  }\r\n\r\n  canPerformAction(actionName, itemState) {\r\n    return this.splitAndTestAction(actionName, itemState);\r\n  }\r\n\r\n  splitAndTestAction(actionName, itemState) {\r\n    const splitAction = actionName.split(\" \");\r\n    return this.testMap[splitAction[0]](itemState, this.theoryCrafterContext, ...(splitAction.slice(1)));\r\n  }\r\n\r\n  performAction(actionName, itemState, splitLocationOverride = null) {\r\n    return this.splitAndExecuteAction(actionName, itemState, splitLocationOverride);\r\n  }\r\n\r\n  splitAndExecuteAction(actionName, itemState, splitLocationOverride = null) {\r\n    const splitAction = actionName.split(\" \");\r\n    const result = this.actionMap[splitAction[0]](itemState, this.theoryCrafterContext, ...(splitAction.slice(1)));\r\n    if (result[0]) {\r\n      if (splitLocationOverride) {\r\n        this.setState(this.insertAndCutStateAt(result[1], actionName, splitLocationOverride));\r\n      }\r\n      else {\r\n        this.setState(this.insertAndCutState(result[1], actionName));\r\n      }\r\n    }\r\n  }\r\n\r\n  handleSelectedBaseChanged(e) {\r\n    this.setState({ ...this.state, selectedBaseId : e.target.value });\r\n  }\r\n\r\n  RenderBaseSelectList() {\r\n    const baseItems = {}\r\n    for (const baseItemId in base_items) {\r\n      if (base_items[baseItemId][\"release_state\"] === \"released\") {\r\n        const domain = base_items[baseItemId][\"domain\"];\r\n        if (domain === \"item\" || domain === \"flask\" || domain === \"abyss_jewel\" || domain === \"misc\") {\r\n          baseItems[baseItemId] = baseItemId.slice(baseItemId.lastIndexOf('/') + 1);\r\n        }\r\n      }\r\n    }\r\n    return <select value={this.state.selectedBaseId} onChange={(x) => this.handleSelectedBaseChanged(x)} key=\"baseItemSelector\">\r\n      { Object.keys(baseItems).map( (k) => <option value={k} key={k}>{baseItems[k]}</option> ) }\r\n    </select>;\r\n  }\r\n\r\n  handleSelectedBaseLevelChanged(e) {\r\n    this.setState({ ...this.state, selectedBaseLevel : e.target.value });\r\n  }\r\n\r\n  RenderBaseSelectLevel() {\r\n    return <input value={this.state.selectedBaseLevel} onChange={(x) => this.handleSelectedBaseLevelChanged(x)} key=\"baseItemLevelInput\"/>;\r\n  }\r\n\r\n  handleBaseSelectButtonClicked() {\r\n    const normalItemState = CreateItem(this.state.selectedBaseId, this.state.selectedBaseLevel, this.theoryCrafterContext);\r\n    this.setState({ ...this.initState(normalItemState), sortMods: this.state.sortMods });\r\n  }\r\n\r\n  RenderBaseSelectButton() {\r\n    return <button onClick={() => this.handleBaseSelectButtonClicked()} key=\"baseItemCreateButton\">Create New Item</button>;\r\n  }\r\n\r\n  RenderCraftingButton(actionName, label) {\r\n    return <CraftingButton onClick={ () => this.performAction(actionName, this.getState()) } enabled={ this.canPerformAction(actionName, this.getState()) } label={label} key={actionName} />\r\n  }\r\n\r\n  RenderFossilSelector(fossilId, label) {\r\n    const checked = this.state.selectedFossils.includes(fossilId);\r\n    const enabled = this.state.selectedFossils.length < 4 || checked;\r\n    return <CraftingButton onClick={ () => this.handleFossilSelectorClicked(fossilId) } enabled={enabled} key={fossilId} label={(checked ? \"\" : \"\") + \" \" + label + \" Fossil\"} />\r\n  }\r\n\r\n  handleFossilSelectorClicked(fossilId) {\r\n    const idx = this.state.selectedFossils.findIndex((x) => { return x === fossilId });\r\n    if (idx >= 0) {\r\n      const newState = { ...this.state };\r\n      newState.selectedFossils.splice(idx, 1);\r\n      this.setState(newState);\r\n    }\r\n    else {\r\n      this.setState({ ...this.state, selectedFossils : [...this.state.selectedFossils, fossilId] });\r\n    }\r\n  }\r\n\r\n  handleSortModsToggled(e) {\r\n    this.setState( {...this.state, sortMods : e.target.checked} );\r\n  }\r\n\r\n  rollTest() {\r\n    let itemState = cloneItemState(this.getState());\r\n    for (let i = 0; i < 100; ++i) {\r\n      itemState = ScourItem(itemState, this.theoryCrafterContext)[1];\r\n      itemState = TransmutationItem(itemState, this.theoryCrafterContext)[1];\r\n    }\r\n    this.setState(this.insertAndCutState(itemState, \"scour\"));\r\n  }\r\n\r\n  render() {\r\n    return [\r\n        <div key=\"baseSelection\">\r\n          { [\r\n            this.RenderBaseSelectList(),\r\n            this.RenderBaseSelectLevel(),\r\n            this.RenderBaseSelectButton(),\r\n          ] }\r\n        </div>,\r\n        <div key=\"craftingButtons\">\r\n          { [\r\n            this.RenderCraftingButton(\"scour\", \"Scour\"),\r\n            this.RenderCraftingButton(\"transmute\", \"Transmutation\"),\r\n            this.RenderCraftingButton(\"aug\", \"Augmentation\"),\r\n            this.RenderCraftingButton(\"alt\", \"Alteration\"),\r\n            this.RenderCraftingButton(\"regal\", \"Regal\"),\r\n            this.RenderCraftingButton(\"alch\", \"Alchemy\"),\r\n            this.RenderCraftingButton(\"chaos\", \"Chaos\"),\r\n            this.RenderCraftingButton(\"exalt\", \"Exalted\"),\r\n            this.RenderCraftingButton(\"exalt_inf crusader\", \"Crusader Exalt\"),\r\n            this.RenderCraftingButton(\"exalt_inf hunter\", \"Hunter Exalt\"),\r\n            this.RenderCraftingButton(\"exalt_inf redeemer\", \"Redeemer Exalt\"),\r\n            this.RenderCraftingButton(\"exalt_inf warlord\", \"Warlord Exalt\"),\r\n            this.RenderCraftingButton(\"annul\", \"Annulment\"),\r\n            this.RenderCraftingButton(\"bless\", \"Blessed\"),\r\n            this.RenderCraftingButton(\"divine\", \"Divine\")\r\n          ] }\r\n        </div>,\r\n        <div key=\"fossilSelectors\">\r\n          { [\r\n            this.RenderFossilSelector(\"Metadata/Items/Currency/CurrencyDelveCraftingAbyss\", \"Hollow\"),\r\n            this.RenderFossilSelector(\"Metadata/Items/Currency/CurrencyDelveCraftingAttackMods\", \"Serrated\"),\r\n            this.RenderFossilSelector(\"Metadata/Items/Currency/CurrencyDelveCraftingBleedPoison\", \"Corroded\"),\r\n            this.RenderFossilSelector(\"Metadata/Items/Currency/CurrencyDelveCraftingCasterMods\", \"Aetheric\"),\r\n            this.RenderFossilSelector(\"Metadata/Items/Currency/CurrencyDelveCraftingChaos\", \"Aberrant\"),\r\n            this.RenderFossilSelector(\"Metadata/Items/Currency/CurrencyDelveCraftingCold\", \"Frigid\"),\r\n            this.RenderFossilSelector(\"Metadata/Items/Currency/CurrencyDelveCraftingCorruptEssence\", \"Glyphic\"),\r\n            this.RenderFossilSelector(\"Metadata/Items/Currency/CurrencyDelveCraftingDefences\", \"Dense\"),\r\n            this.RenderFossilSelector(\"Metadata/Items/Currency/CurrencyDelveCraftingElemental\", \"Prismatic\"),\r\n            this.RenderFossilSelector(\"Metadata/Items/Currency/CurrencyDelveCraftingEnchant\", \"Enchanted\"),\r\n            this.RenderFossilSelector(\"Metadata/Items/Currency/CurrencyDelveCraftingFire\", \"Scorched\"),\r\n            this.RenderFossilSelector(\"Metadata/Items/Currency/CurrencyDelveCraftingGemLevel\", \"Faceted\"),\r\n            this.RenderFossilSelector(\"Metadata/Items/Currency/CurrencyDelveCraftingLife\", \"Pristine\"),\r\n            this.RenderFossilSelector(\"Metadata/Items/Currency/CurrencyDelveCraftingLightning\", \"Metallic\"),\r\n            this.RenderFossilSelector(\"Metadata/Items/Currency/CurrencyDelveCraftingLuckyModRolls\", \"Sanctified\"),\r\n            this.RenderFossilSelector(\"Metadata/Items/Currency/CurrencyDelveCraftingMana\", \"Lucent\"),\r\n            this.RenderFossilSelector(\"Metadata/Items/Currency/CurrencyDelveCraftingMinionsAuras\", \"Bound\"),\r\n//            this.RenderFossilSelector(\"Metadata/Items/Currency/CurrencyDelveCraftingMirror\", \"Fractured\"),\r\n            this.RenderFossilSelector(\"Metadata/Items/Currency/CurrencyDelveCraftingPhysical\", \"Jagged\"),\r\n//            this.RenderFossilSelector(\"Metadata/Items/Currency/CurrencyDelveCraftingQuality\", \"Perfect\"),\r\n            this.RenderFossilSelector(\"Metadata/Items/Currency/CurrencyDelveCraftingRandom\", \"Tangled\"),\r\n            this.RenderFossilSelector(\"Metadata/Items/Currency/CurrencyDelveCraftingSellPrice\", \"Gilded\"),\r\n//            this.RenderFossilSelector(\"Metadata/Items/Currency/CurrencyDelveCraftingSockets\", \"Encrusted\"),\r\n            this.RenderFossilSelector(\"Metadata/Items/Currency/CurrencyDelveCraftingSpeed\", \"Shuddering\"),\r\n            this.RenderFossilSelector(\"Metadata/Items/Currency/CurrencyDelveCraftingVaal\", \"Bloodstained\"),\r\n          ] }\r\n        </div>,\r\n        <div key=\"fossilButton\">\r\n          { [\r\n            this.RenderCraftingButton([\"fossil\", ...this.state.selectedFossils].join(\" \"), \"Fossil\")\r\n          ] }\r\n        </div>,\r\n        <div key=\"undoDiv\"><CraftingButton onClick={ () => this.undoState() } enabled={ this.canUndoState() } label={ this.getUndoLabel() } key=\"undo\" /></div>,\r\n        <div key=\"redoDiv\"><CraftingButton onClick={ () => this.redoState() } enabled={ this.canRedoState() } label={ this.getRedoLabel() } key=\"redo\" /></div>,\r\n        <div key=\"rerollDiv\"><CraftingButton onClick={ () => this.rerollAction() } enabled={ this.canRerollAction() } label={ this.getRerollLabel() } key=\"undo\" /></div>,\r\n//        <div key=\"rollTest\"><CraftingButton onClick={ () => this.rollTest() } enabled={ true } label=\"Roll 100000\" /></div>,\r\n        <div key=\"sortMods\"><input type=\"checkbox\" onChange={(e) => this.handleSortModsToggled(e)} checked={this.state.sortMods} /><span style={{color: 'white'}}>Sort Mods</span></div>,\r\n        <div className=\"itemAndModListContainer\" key=\"itemAndModListContainer\">\r\n          {[\r\n            <div className=\"craftedItemContainer\" key=\"craftedItemContainer\">\r\n              <CraftedItem itemState={ this.state.itemStateHistory[this.state.itemStateHistoryIdx].itemState } context={this.theoryCrafterContext} sortMods={this.state.sortMods} key=\"craftedItem\" />\r\n            </div>,\r\n            <div className=\"modListContainer\" key=\"modListContainer\">\r\n              <ModList fossilTypes={this.state.selectedFossils} itemState={ this.state.itemStateHistory[this.state.itemStateHistoryIdx].itemState } context={this.theoryCrafterContext} key=\"modList\" />\r\n            </div>\r\n          ]}\r\n        </div>\r\n    ]\r\n  }\r\n}\r\n\r\nfunction App() {\r\n  return <TheoryCrafter />\r\n}\r\n\r\nexport default App;\r\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}